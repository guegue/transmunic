{% extends "_indicator.html" %}
{% load static thumbnail chartit %}
{% load humanize %}
{% load mathfilters %}
{% load core_extras %}
{# TODO: Replace this by django-seo2 #}
{% block titulo %}
{{ municipio }}
{% endblock %}

{% block indicator_title %}
<h2 class="text-center">{% if municipio %}<strong>{{ municipio }}</strong><br/>{% else %}Consolidado{% endif %}</h2>
<hr class="pma-line-5"/>
<h4 class="text-center">
    <strong>Origen de los Ingresos {% if year %}{{ year }}{% else %}2015 {% endif %}</strong>
</h4>
<p class="text-center metric-description container"> {% block indicator_description %} Son los ingresos que capta el sector público para realizar sus actividades, es decir, es el dinero percibido por el gobierno para financiar sus gastos públicos
{% endblock %}
</p>
{% endblock %}

{% block indicator_summary %}
<div class="col-xs-6 col-sm-4 col-md-4">
    <div class="info-box">
        <span class="info-box-icon pma-icon initial">
        </span>
        <div class="info-box-content">
            <span class="info-box-text"><strong>Inicial {{ asignado|million|intcomma }}</strong></span>
        </div>
    </div>
</div>
{% if ejecutado %}
<div class="col-xs-6 col-sm-4 col-md-4">
    <div class="info-box">
        <span class="info-box-icon pma-icon executed">
        </span>
        <div class="info-box-content">
            <span class="info-box-text">
            <strong>Ejecutado {{ ejecutado|million|intcomma }}</strong>
            </span>
            <span class="info-box-number pma-green"></span>
        </div>
    </div>
</div>
{% endif %}
{% if municipio %}
<div class="col-xs-12 col-sm-4 col-md-4">
    <div class="info-box">
        <span class="info-box-icon pma-icon municipality-category">
        </span>
        <div class="info-box-content">
            <span class="info-box-text"><strong>Categor&iacute;a de municipio {{ mi_clase.clasificacion }}</strong></span>
            <span class="info-box-number pma-green"></span>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block section1 %}
<div class="container">
    <div class="row">
        <h2> <strong>Ingresos</strong> Totales</h2>
        <hr class="pma-line-2">
        <div class="col-md-7">
            <div class="chart-update col-xs-12 col-sm-1 col-md-1 float-left">
                <span class="pma-icon pe-7s-bubble pma-fg-gray toggle-chart"
                aria-hidden="true" id="chart-bubble-1" data-chartcontainer="bubble-1"></span>
                <span id="chart-pie-1" class="pma-icon pe-7s-graph
                pma-fg-gray toggle-chart" aria-hidden="true"
                data-chartcontainer="ejecutado"></span>
                {% if not municipio %}
                <span id="chart-bar-1" class="pma-icon pe-7s-graph3 pma-fg-gray toggle-chart" data-chartcontainer="comparativo2"></span>
                {% else %}
                <span id="chart-bar-1" class="pma-icon pe-7s-graph3 pma-fg-gray toggle-chart" data-chartcontainer="ejecutado_column"></span>
                {% endif %}
                <span class="pma-icon pe-7s-graph2 pma-fg-gray toggle-chart"
                data-chartcontainer="icons" id="chart-icons"></span>
            </div>
            <div class="col-md-11 bubbletree-container chart-container">
                <div id="bubble-1" class="bubbletree-wrapper view-main ">
                    <div class="bubbletree"></div>
                </div>
                <div id="ejecutado" class="view-alternative"> Pastel Ejecucion por
                    Rubros </div>
                <div id="ejecutado_column" class="view-alternative "> Barras Ejecucion por
                        Rubros </div>
                {% if not municipio %}
                <div id='comparativo2' class="view-alternative"> Chart will be rendered here </div>
                {% else %}
                <div id='comparativo_anios' class="view-alternative"> Chart will be rendered here </div>
                {% endif %}
                <div id="icons" class="view-alternative col-xs-11 col-md-12 pma-large-icons">
                    <div class="row">
                        {% for origen in rubros %}
                        <div class="col-xs-9 col-sm-6 col-md-6">
                            <div class="info-box">
                                <span class="info-box-icon pma-fg-green pma-icon {{origen.subsubtipoingreso__origen__slug}}">
                                </span>
                                <div class="info-box-content">
                                    <span class="info-box-text">{{origen.subsubtipoingreso__origen__nombre}}</span>
                                    <span class="info-box-number pma-blue">Inicial: {{ origen.asignado_percent }}%</span>
                                    <span class="info-box-number pma-green">Final: {{ origen.ejecutado_percent }}%</span>
                                </div>
                                <!-- /.info-box-content -->
                            </div>
                            <!-- /.info-box -->
                        </div>
                        {% if forloop.counter|divisibleby:2 and not forloop.last %}
                    </div>
                    <div class="row">
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-5 general-table table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr class="bg-primary">
                        <th>Rubros de ingresos</th>
                        {% if periodo_list|keyvalue:year == 'I' %}
                        <th class="text-right">Inicial</th>
                        {% else %}
                        <th class="text-right">Ejecutado</th>
                        {% endif %}
                    </tr>
                </thead>
                {% for row in rubros %}
                <tr>
                    <td>{{ row.subsubtipoingreso__origen__nombre}}</td>
                    {% if periodo_list|keyvalue:year == 'I' %}
                    <td class="text-right">{{ row.inicial_asignado|million|intcomma }}</td>
                    {% else %}
                    <td class="text-right">{{ row.ejecutado|million|intcomma|default:"0" }}</td>
                    {% endif %}
                </tr>
                {% endfor %}
                <tfoot>
                    <tr class="">
                        <td>TOTAL</td>
                        {% if periodo_list|keyvalue:year == 'I' %}
                        <td class="text-right">{{ asignado|million|intcomma }}</td>
                        {% else %}
                        <td class="text-right">{{ejecutado|million|intcomma|default:"0" }}</td>
                        {% endif %}
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block section2 %}
{% if not municipio %}
<div class="cd-horizontal-timeline loaded pma-gradient">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
            {% if year == '2016' %}
                <h2>Recaudación por habitante</h2>
            {% else %}
                <h2><strong>Ranquin de recaudación </strong> <br>
                {% if mi_clase.clasificacion%}
                    por habitante categoría municipal "{{ mi_clase.clasificacion }}"
                {% else %}
                    según categoría de municipios
                {% endif %}
                </h2>
                <h5>Córdobas corrientes por habitante {% if periodo_list|keyvalue:year == 'I' %}en base a ingresos asignados{% else %} en base a ingresos ejecutados{% endif %}</h5>
            {% endif %}
            <hr class="pma-line-3" />
            </div>
        </div>
    </div>
    <div class="timeline container rankin">
        <div class="events-wrapper">
            <div class="events" style="width: {{ porclase|length|mul:130 }}px;">
                <ol>
                    {% for row in porclasep %}
                    <li>
                        <a href="#0"
                            data-date="{% now "SHORT_DATETIME_FORMAT" %} 00:{{ forloop.counter }}"
                            {% if forloop.first %}class="selected"{% endif %}
                            style="left: {{ forloop.counter|mul:120 }}px;"><span class="posicion">{{ row.clasificacion }}</span><br/>
                            {% if periodo_list|keyvalue:year == 'I' %}
                                <span class="line-cifra">{% if row.asignado %}{{ row.asignado|floatformat:2|intcomma }}{% else %} 0 {% endif %}</span><br/>
                            {% else %}
                                <span class="line-cifra">{% if row.ejecutado %}{{ row.ejecutado|floatformat:2|intcomma }} {% else %} 0 {% endif %}</span>
                            {% endif %}
                        </a>
                    </li>
                    {% endfor %}
                </ol>
                <span class="filling-line" aria-hidden="true" style="transform: scaleX(0.0772222);"></span>
            </div> <!-- .events -->
        </div> <!-- .events-wrapper -->

        <ul class="cd-timeline-navigation">
            <li><a href="#0" class="prev inactive">Prev</a></li>
            <li><a href="#0" class="next">Next</a></li>
        </ul> <!-- .cd-timeline-navigation -->
    </div> <!-- .timeline -->
    <div class="events-content container text-center">
        <ol>
        {% for row in porclasep %}
        <li{% if forloop.first %} class="selected"{% endif %} data-date="{% now "SHORT_DATETIME_FORMAT" %} 00:{{ forloop.counter }}">
        <!--
           <h4>{{ row.clasificacion }}</h4>
        -->
        </li>
        {% endfor %}
        </ol>
    </div> <!-- .events-content -->

    <div class="container">
        <div class="row">
            <div class="col-md-12 medium text-center">
                <button id="show-detail-1" class="blanco btn pma-bg-blue more" type="submit">
                Ver detalles en tabla</button>
            </div>
        </div>
    </div>
    <div class="container" id="detail-1">
    <div class="row">
        <div class="col-md-offset-4 col-md-4 table-responsive">
            <table class="table">
                <tr class="blanco pma-bg-blue">
                    <th><strong>Categoría de municipio</strong></th>
                    {% if periodo_list|keyvalue:year == 'I' %}
                      <th><strong>Presupuestado</strong></th>
                    {% else %}
                      <th><strong>Ejecutado</strong></th>
                    {% endif %}
                    </tr>
                {% for row in porclasep %}
                <tr class="pma-bg-white">
                    <td class="text-center">{{ row.clasificacion }}</td>
                    {% if periodo_list|keyvalue:year == 'I' %}
                        <td class="text-right">{% if row.asignado %}{{ row.asignado|floatformat:2|intcomma }}{% else %} 0 {% endif %}</td>
                    {% else %}
                    <td class="text-right">{% if row.ejecutado %}{{ row.ejecutado|floatformat:2|intcomma }} {% else %} 0 {% endif %}</td>
                    {% endif %}
                </tr>
                {% endfor %}
                <tr class="blanco pma-bg-blue">
                    <td><strong>Media Nacional</strong></td>
                    {% if periodo_list|keyvalue:year == 'I' %}
                        <td class="text-right"><strong>{{ porclasep|total_sum:'asignado'|floatformat:2|intcomma }}</strong></td>
                    {% else %}
                        <td class="text-right"><strong>{{ porclasep|total_sum:'ejecutado'|floatformat:2|intcomma }}</strong></td>
                    {% endif %}
                </tr>
            </table>
        </div>
    </div>
  </div>
</div>
{% endif%}
{% endblock %}

{% block section3 %}
{% if municipio %}
<div class="cd-horizontal-timeline loaded pma-gradient inverted">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
            <h2><strong>Ranking de recaudación </strong> <br>
                por habitante categoría municipal
                "{{ mi_clase.clasificacion }}"</h2>
            <h5>Córdobas corrientes por habitante {% if periodo_list|keyvalue:year == 'I' %}en base a ingresos asignados{% else %} en base a ingresos ejecutados{% endif %}</h5>
            <hr class="pma-line-3" />
            </div>
        </div>
    </div>
    <div class="timeline container rankin">
        <div class="events-wrapper">
            <div class="events" style="width: {{ otros|length|mul:300 }}px;">
                <ol>
                    {% for row in otros|dictsortreversed:"asignado_percent" %}
                    <li>
                        <a href="#0"
                            data-date="{% now "SHORT_DATETIME_FORMAT" %} 00:{{ forloop.counter }}"
                            {% if municipio.slug == row.ingreso__municipio__slug%} class="selected"{% endif %}
                            style="left: {{ forloop.counter|mul:180 }}px;"><span class="posicion"> {{forloop.counter}}</span>
                            <br /><div class="municipio_nombre">{{ row.ingreso__municipio__nombre }}</div>
                            {% if periodo_list|keyvalue:year == 'I' %}
                                <span class="line-cifra">{{ row.asignado_percent|intcomma }}
                                </span><br/>
                            {% else %}
                              <span class="line-cifra">{{ row.asignado_percent|intcomma }}</span>
                            {% endif %}
                        </a>
                    </li>
                    {% endfor %}
                </ol>
                <span class="filling-line" aria-hidden="true" style="transform: scaleX(0.0772222);"></span>
            </div> <!-- .events -->
        </div> <!-- .events-wrapper -->

        <ul class="cd-timeline-navigation">
            <li><a href="#0" class="prev inactive">Prev</a></li>
            <li><a href="#0" class="next">Next</a></li>
        </ul> <!-- .cd-timeline-navigation -->
    </div> <!-- .timeline -->
    <div class="events-content container text-center">
        <ol>
        {% for row in otros|dictsortreversed:"asignado_percent" %}
        <li{% if municipio.slug == row.ingreso__municipio__slug%} class="selected"{% endif %} data-date="{% now "SHORT_DATETIME_FORMAT" %} 00:{{ forloop.counter }}">
        <!-- <h4>{{ row.ingreso__municipio__nombre }}</h4>
        <span> Asignado: {{ row.asignado_percent|intcomma }}
        </span><br/>
        <span> Ejecutado: {{ row.asignado_percent|intcomma }}</span> -->
        </li>
        {% endfor %}
        </ol>
    </div> <!-- .events-content -->

    <div class="container">
        <div class="row">
            <div class="col-md-12 text-center medium">
                <button id="show-detail-1" class="blanco btn pma-bg-blue more" type="submit">
                Ver detalles en tabla</button>
            </div>
        </div>
    </div>
    <div id="detail-1" class="container">
        <div class="row">
            <div class="col-md-offset-3 col-md-6 table-responsive">
                <table class="table table-striped pma-bg-white">
                    <thead class="thead-inverse">
                        <tr class="bg-primary">
                        <th class="text-center"><strong>Posición</strong></th>
                        <th class="text-center"><strong>Municipios</strong></th>
                        {% if periodo_list|keyvalue:year == 'I' %}
                            <th class="text-center"><strong>P. Inicial</strong></th>
                        {% else %}
                            <th class="text-center"><strong>Ejecución</strong></th></tr>
                        {% endif %}
                    </thead>
                    {% if ejecutado <= 0 %}
                    {% for row in otros|dictsortreversed:"asignado_percent" %}
                    {% if municipio.slug == row.ingreso__municipio__slug%} <tr class="info">
                        {% else %}
                        <tr>
                            {% endif %}
                            <td class="text-center"> {{forloop.counter}} </td>
                            <td>{{ row.ingreso__municipio__nombre }}</td>
                            {% if periodo_list|keyvalue:year == 'I' %}
                                <td class="text-right">{{ row.asignado_percent|intcomma }}</td>
                            {% else %}
                                <td class="text-right">{{ row.ejecutado_percent|intcomma }}</td>
                            {% endif %}
                        </tr>
                        {% endfor %}
                        {% else %}
                        {% for row in otros %}
                        {% if municipio.slug == row.ingreso__municipio__slug%}
                        <tr class="info">
                            {% else %}
                            <tr>
                                {% endif %}
                                <td class="text-center"> {{forloop.counter}} </td>
                                <td>{{ row.ingreso__municipio__nombre }}</td>
                                {% if periodo_list|keyvalue:year == 'I' %}
                                    <td class="text-right">{{ row.asignado_percent|intcomma }}</td>
                                {% else %}
                                    <td class="text-right">{{ row.ejecutado_percent|intcomma }}</td>
                                {% endif %}
                            </tr>
                            {% endfor %} {% endif %}
<!--
                            <tr class="">
                                <td colspan="2">TOTAL</td>
                                <td class="text-right">
                                    {% if numerador > 0 %}
                                        {% with numerator=otros|total_sum:'asignado' denominator=otros|total_sum:'poblacion' %} {{ numerator|div:denominator|floatformat:2|intcomma }} {% endwith %}
                                    {% endif %}
                                </td>
                                {% if year != '2016' %}
                                <td class="text-right">
                                    {% if denominador > 0 %}
                                        {% with numerator=otros|total_sum:'ejecutado' denominator=otros|total_sum:'poblacion' %} {{ numerator|div:denominator|floatformat:2|intcomma }} {% endwith %}
                                    {% endif %}
                                </td>
                                {% endif %}
                            </tr>
                        -->
                </table>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block section4 %}
<div class="container wide">
    <div class="row">
        <div class="col-md-12">
            <h2><strong>Información Histórica</strong><br>
            Ejecución Presupuestaria {% if not municipio %}Consolidado municipal {% endif %} </h2>
            <hr class="pma-line-2" />
        </div>
    </div>
</div>
<div class="cd-horizontal-timeline loaded">
    <div class="timeline container historico">
        <div class="events-wrapper col-md-11">
            <div class="events" style="{{anuales|length|mul:"100"}}px">
                <ol>
                    {% for row in anuales %}
                    <li><a href="#0" data-date="01/01/{{ row.ingreso__anio }}"
                    {% if row.ingreso__anio = year|add:"0" %} class="selected" {% endif %}
                    style="left:{{ forloop.counter|mul:"100" }}px;"><span class="posicion">{{ row.ingreso__anio }}</span>
                    <br/>
                    {% if row.ingreso__periodo == 'I' %}
                        <span class="line-cifra">{{ row.asignado|million|intcomma }}</span>
                    {% else %}
                        <span class="line-cifra">{{ row.ejecutado|million|intcomma }}</span>
                    {% endif %}
                    </a></li>
                    {% endfor %}
                </ol>
                <span class="filling-line" aria-hidden="true" style="transform: scaleX(0.0772222);"></span>
            </div> <!-- .events -->
        </div> <!-- .events-wrapper -->

        <ul class="cd-timeline-navigation">
            <li><a href="#0" class="prev inactive">Prev</a></li>
            <li><a href="#0" class="next">Next</a></li>
        </ul> <!-- .cd-timeline-navigation -->
    </div> <!-- .timeline -->

    <div class="events-content">
        <ol>
	    {% for row in anuales %}
	    <li><a href="#0" data-date="01/01/{{ row.ingreso__anio }}"
	    {% if row.ingreso__anio = year|add:"0" %} class="selected" {% endif %}
	    style="left:{{ forloop.counter|mul:"100" }}px;"></a></li>
	    {% endfor %}
        </ol>
    </div> <!-- .events-content -->
</div>
<div class="container">
    <div class="row">
        <div class="col-md-12 text-center medium">
            <button id="show-detail-3" class="blanco btn pma-bg-blue more" type="submit">
            Ver detalles en tabla</button>
        </div>
    </div>
</div>
<div id="detail-3" class="container medium">
    <div class="row">
        <div class="col-xs-12 col-md-offset-1 col-md-10 table-responsive">
            <table class="table">
                <tr class="bg-primary">
                    <th></th>
                    {% for year in year_list %}
                    <th class="text-center"><strong>{{ year }}</strong>
                        {% if periodo_list|keyvalue:year == 'A' %}*Actualizado*{% endif %}</th>
                        {% endfor %}
                    </tr>
                    {% for key, data in porano.items %}
                    <tr>
                        <td class="text-left">{{ key }}</td>
                        {% for year in year_list %}
                        <td class="text-right">{{ data|keyvalue:year|million|intcomma }}</td>
                        {% endfor %}
                </tr>
                {% endfor %}
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block section5 %}
{% if rubros|total_sum:'actualizado_asignado' > 0 %} <!--No mostramos tablas si no hay actualizacion --!>
<div class="container wide">
    <div class="row">
        <div class="col-md-12">
            <h2><strong>Modificaciones al presupuesto</strong><br>
            municipal de ingresos </h2>
             <h4>Millones de cordobas</h4>
            <hr class="pma-line-2" />
        </div>
    </div>
    <div class="row">
        <div class="col-md-offset-2 col-md-8 table-responsive">
        <table class="table table-condensed table-striped">
            <thead>
            <tr  class="bg-primary"> <th>Rubros de ingresos</th> <th>Inicial</th> <th>Actualizado</th><th>Ejecutado</th>
            </tr>
            </thead>
            {% for row in rubros %}
                <tr>
                    <td class="pull-left">{{ row.subsubtipoingreso__origen__nombre}}</td>
                    <td class="text-right">{{ row.inicial_asignado|million|intcomma }}</td>
                    <td class=" text-right">{{ row.actualizado_asignado|million|intcomma }}</td>
                    <td class="text-right">{% if row.final_ejecutado %}{{ row.final_ejecutado|million|intcomma }}{% else %}0{% endif %}</td>
                </tr>
            {% endfor %}
            <tfoot>
            <tr class="bold">
                <td>TOTAL</td>
                <td class="text-right">{{ rubros|total_sum:'inicial_asignado'|million|intcomma }}</td>
                <td class="text-right">{{ rubros|total_sum:'actualizado_asignado'|million|intcomma }}</td>
                <td class="text-right">{{ rubros|total_sum:'final_ejecutado'|million|intcomma }}</td>
            </tr>
            </tfoot>
        </table>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-md-12 text-center medium">
                <button id="show-detail-2" class="blanco btn pma-bg-blue more" type="submit">
                Ver detalles </button>
            </div>
        </div>
    </div>

    <div id="detail-2" class="row">
        <div class="col-md-12 table-responsive">
         <div class="collapse" id="collapsemodificacion">
            <div class="well">
                <div class="col-md-3 pull-left">Las transferencias se asigna cada año según los criterios establecido en la ley de transferencias y están distribuidas en gatos corrientes y capital.<p></div>
                <div class="col-md-7"><div id='comparativo3'> Chart will be rendered here </div></div>
            </div>
        </div>
        <table class="table table-bordered">
            <tr>
                <td></td>
                <td></td>
                <th colspan="4" class="text-center">
                    <h4>Modificación intermedia
                        <a href="#" data-toggle="tooltip" data-original-title="Modificación al {{ year_data.actualizado }}" class="link-info">*</a>
                    </h4>
                </th>
                <td colspan="4" class="text-center">
                    <h4>Modificación al cierre
                        <a href="#" data-toggle="tooltip" data-original-title="Modificación al {{ year_data.final }}" class="link-info">*</a></h4>
                </th>
            </tr>
            <tr> <th>Rubros de ingresos</th> <th>Inicial</th>
                <th>Actualizado</th> <th>Modificación</th> <th>Ejecutado</th> <th><a href="#" data-toggle="tooltip" data-original-title="Ejecutado/Actualizado" class="link-info">%</a></th>
                <th>Actualizado</th> <th>Modificación</th> <th>Ejecutado</th> <th><a href="#" data-toggle="tooltip" data-original-title="Ejecutado/Actualizado" class="link-info">%</a></th>
            </tr>
            {% for row in rubros %}
                <tr>
                    <td>{{ row.subsubtipoingreso__origen__nombre}}</td>
                    <td class="text-right">{{ row.inicial_asignado|million|intcomma }}</td>

                    <td class="text-right">{{ row.actualizado_asignado|million|intcomma }}</td>
                    <td class="text-right">{% if row.actualizado_asignado and row.inicial_asignado %}{{ row.actualizado_asignado|sub:row.inicial_asignado|million|intcomma }}{% else %}0{% endif %}</td>
                    <td class="text-right">{{ row.actualizado_ejecutado|million|intcomma }}</td>
                    {% if row.actualizado_asignado %}
                        <td class="montos">{{ row.actualizado_ejecutado|div:row.actualizado_asignado|mul:100|floatformat:1|intcomma }}%</td>
                    {% else %}
                        <td class="montos">0</td>
                    {% endif %}

                    <td class="text-right">{% if row.final_asignado %}{{ row.final_asignado|million|intcomma }}{% else %}0 {% endif %}</td>
                    <td class="text-right">{% if row.final_asignado %}{{ row.final_asignado|sub:row.inicial_asignado|million|intcomma }}{% else %}0{% endif %}</td>
                    <td class="text-right">{% if row.final_ejecutado %}{{ row.final_ejecutado|million|intcomma }}{% else %}0{% endif %}</td>
                    {% if row.final_asignado %}
                        <td class="montos">{{ row.final_ejecutado|div:row.final_asignado|mul:100|floatformat:1|intcomma }}%</td>
                    {% endif %}
                </tr>
            {% endfor %}
            <tr class="success bold">
                <td>TOTAL</td>
                <td class="text-right">{{ rubros|total_sum:'inicial_asignado'|million|intcomma }}</td>
                <td class="text-right">{{ rubros|total_sum:'actualizado_asignado'|million|intcomma }}</td>
                {% with sum_asignado=rubros|total_sum:'inicial_asignado' %}
                    <td class="montosi text-right">
                    {% if rubros|total_sum:'actualizado_asignado' %}
                        {{ rubros|total_sum:'actualizado_asignado'|sub:sum_asignado|million|intcomma }}
                    {% else %}
                        0
                    {% endif %}
                </td>
                {% endwith %}
                <td class="text-right">{{ rubros|total_sum:'actualizado_ejecutado'|million|intcomma }}</td>
                {% with sum_actualizado=rubros|total_sum:'actualizado_asignado' %}
                    <td class="montos text-right">
                        {% if sum_actualizado %}
                        {{ rubros|total_sum:'actualizado_ejecutado'|div:sum_actualizado|mul:100|floatformat:1|intcomma}}%
                        {% endif %}
                    </td>
                {% endwith %}
                <!-- totales periodo final -->
                <td class="text-right">{{ rubros|total_sum:'final_asignado'|million|intcomma }}</td>
                {% with sum_asignado=rubros|total_sum:'inicial_asignado' %}
                    <td class="montos text-right">
                    {% if rubros|total_sum:'final_asignado' %}
                        {{ rubros|total_sum:'final_asignado'|sub:sum_asignado|million|intcomma }}
                    {% else %}
                        0
                    {% endif %}
                </td>
                {% endwith %}
                <td class="text-right">{{ rubros|total_sum:'final_ejecutado'|million|intcomma }}</td>
                {% with sum_actualizado=rubros|total_sum:'final_asignado' %}
                    <td class="montos text-right">
                        {% if sum_actualizado %}
                        {{ rubros|total_sum:'final_ejecutado'|div:sum_actualizado|mul:100|floatformat:1|intcomma}}%
                        {% endif %}
                    </td>
                {% endwith %}
            </tr>
        </table>
        <br />
        <!-- /fin oim-tabla5 -->
        <h3><strong>Recaudación municipal</strong></h3>
        <h4>Millones de córdobas corrientes</h4>
        <table class="table table-bordered">
            <tr><td></td><td></td><td colspan="4" class="text-center"><h4>Modificación al {{ year_data.actualizado }}</h4></td><td colspan="4"><h4>Modificación al {{ year_data.final }}</h4></td></tr>
            <tr> <th>Rubros de ingresos</th> <th>Inicial</th>
                <th>Actualizado</th> <th>Modificación</th> <th>Ejecutado</th> <th><a href="#" data-toggle="tooltip" data-original-title="Ejecutado/Actualizado" class="link-info">%</a></th>
                <th>Actualizado</th> <th>Modificación</th> <th>Ejecutado</th> <th><a href="#" data-toggle="tooltip" data-original-title="Ejecutado/Actualizado" class="link-info">%</a></th>
            </tr>
            {% for row in rubrosp %}
                <tr>
                    <td>{{ row.subtipoingreso__nombre }}</td>
                    <td class="text-right">{{ row.inicial_asignado|million|intcomma }}</td>
                    <td class="text-right">{{ row.actualizado_asignado|million|intcomma }}</td>
                    <td class="text-right">{% if row.actualizado_asignado and row.inicial_asignado %}{{ row.actualizado_asignado|sub:row.inicial_asignado|million|intcomma }}{% else %}0{% endif %}</td>
                    <td class="text-right">{{ row.actualizado_ejecutado|million|intcomma }}</td>
                    {% if row.actualizado_asignado %}
                        <td class="montos">{{ row.actualizado_ejecutado|div:row.actualizado_asignado|mul:100|floatformat:1|intcomma }}%</td>
                    {% else %}
                        <td class="montos">0</td>
                    {% endif %}

                    <td class="text-right">{% if row.final_asignado %}{{ row.final_asignado|million|intcomma }}{% else %}0 {% endif %}</td>
                    <td class="text-right">{% if row.inicial_asignado %}{{ row.final_asignado|sub:row.inicial_asignado|million|intcomma }}{% else %}0{% endif %}</td>
                    <td class="text-right">{% if row.final_ejecutado %}{{ row.final_ejecutado|million|intcomma }}{% else %}0{% endif %}</td>
                    {% if row.final_asignado %}
                        <td class="montos">{{ row.final_ejecutado|div:row.final_asignado|mul:100|floatformat:1|intcomma }}%</td>
                    {% endif %}
                </tr>
            {% endfor %}
            <tr class="success bold">
                <td>TOTAL</td>
                <td class="text-right">{{ rubrosp|total_sum:'inicial_asignado'|million|intcomma }}</td>
                <td class="text-right">{{ rubrosp|total_sum:'actualizado_asignado'|million|intcomma }}</td>
                {% with sum_asignado=rubrosp|total_sum:'inicial_asignado' %}
                    <td class="montosi text-right">
                    {% if rubrosp|total_sum:'actualizado_asignado' %}
                        {{ rubrosp|total_sum:'actualizado_asignado'|sub:sum_asignado|million|intcomma }}
                    {% else %}
                        0
                    {% endif %}
                </td>
                {% endwith %}
                <td class="text-right">{{ rubrosp|total_sum:'actualizado_ejecutado'|million|intcomma }}</td>
                {% with sum_actualizado=rubrosp|total_sum:'actualizado_asignado' %}
                    <td class="montos text-right">
                        {% if sum_actualizado %}
                        {{ rubrosp|total_sum:'actualizado_ejecutado'|div:sum_actualizado|mul:100|floatformat:1|intcomma}}%
                        {% endif %}
                    </td>
                {% endwith %}
                <!-- totales periodo final -->
                <td class="text-right">{{ rubrosp|total_sum:'final_asignado'|million|intcomma }}</td>
                {% with sum_asignado=rubrosp|total_sum:'inicial_asignado' %}
                    <td class="montosi text-right">
                    {% if rubrosp|total_sum:'final_asignado' %}
                        {{ rubrosp|total_sum:'final_asignado'|sub:sum_asignado|million|intcomma }}
                    {% else %}
                        0
                    {% endif %}
                </td>
                {% endwith %}
                <td class="text-right">{{ rubrosp|total_sum:'final_ejecutado'|million|intcomma }}</td>
                {% with sum_actualizado=rubrosp|total_sum:'final_asignado' %}
                    <td class="montos text-right">
                        {% if sum_actualizado %}
                        {{ rubrosp|total_sum:'final_ejecutado'|div:sum_actualizado|mul:100|floatformat:1|intcomma}}%
                        {% endif %}
                    </td>
                {% endwith %}
            </tr>
        </table>
        </div>
    </div>
</div>
{% else %}
{% endif %}

{% endblock %}

{% block custom_scripts %}
    {% if municipio and charts.4 %}
    {{ charts|load_charts:"ejecutado, ejecutado_column, comparativo_anios, tipo, asignado_barra, barra" }}
    {% else %}
    {{ charts|load_charts:"ejecutado, ejecutado_column,tipo,comparativo_anios" }}
    {% endif %}
{% endblock %}
