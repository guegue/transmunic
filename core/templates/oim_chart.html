{% extends "_indicator.html" %}
{% load static thumbnail chartit %}
{% load humanize %}
{% load mathfilters %}
{% load core_extras %}
{# TODO: Replace this by django-seo2 #}
{% block titulo %}
{{ municipio }}
{% endblock %}

{% block custom_header_links %}
    <link rel="stylesheet" href="{% static 'css/pe-icon-7-stroke.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/charts.css' %}" />
    <link rel="stylesheet" type="text/css" href="{% static 'css/bubbletree.css' %}" />
{% endblock %}
{% block custom_footer_scripts %}
    <script type="text/javascript" src="{% static 'js/jquery-migrate.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/jquery.history.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/raphael-min.js' %}"></script>
    <script type="text/javascript  " src="{% static 'js/Tween.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/bubbletree.js' %}"></script>
    <script type="text/javascript" src="http://assets.openspending.org/openspendingjs/master/lib/aggregator.js"></script>
    <script type="text/javascript" src="{% static 'js/cofog.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/bar-chart.js' %}"></script>
    <script type="text/javascript">
        $(function() {
            var $tooltip = $('<div class="tooltip">Tooltip</div>');
            $('.bubbletree').append($tooltip);
            $tooltip.hide();

            var tooltip = function(event) {
                if (event.type == 'SHOW') {
                    // show tooltip
                    vis4.log(event);
                    $tooltip.css({
                        left: event.mousePos.x + 4,
                        top: event.mousePos.y + 4
                    });
                    $tooltip.html(event.node.label+' <b>'+event.node.famount+'</b>');
                    var bubble = event.target;

                    $tooltip.show();
                } else {
                    // hide tooltip
                    $tooltip.hide();
                }
            };
            var data = {{ bubble_data|safe }}
            $.each( data['children'], function( key, value ) {
                data['children'][key]['color'] =  vis4color.fromHSL(key/data.children.length*360, .7, .5).x;
                var node_color =  vis4color.fromHSL(key/data.children.length*360, .7, .5).x;
                $.each(data['children'][key]['children'], function(j, val){
                    data['children'][key]['children'][j]['color'] =  vis4color.fromHex(node_color).lightness('*'+(.5+Math.random()*.5)).x;
                });
            });

            new BubbleTree({
                data: data,
                container: '.bubbletree',
                bubbleType: 'icon',
                bubbleStyles: {
                    'cofog': BubbleTree.Styles.Cofog
                },
                formatValue: function(value) {
                    return 'C$ ' + value.toString() + 'M';
                }
            });
        });
    </script>
    <script>
    $('#oimTab a').click(function (e) {
        e.preventDefault();
        $(this).tab('show')
    });
    $(document).ready(function(){
            $('[data-toggle="tooltip"]').tooltip({
                            placement : 'top'
                        });
            });
    </script>
{% endblock %}

    {% block header_title %}
    <h2 class="text-center">{% if municipio %}<strong>{{ municipio }}</strong><br/>{% endif %} Origen de los ingresos <strong>{% if year %}{{ year }}{% else %}2015 {% endif %}</strong></h2>
    {% endblock %}

    {% block header_summary %}
    <div class="col-md-4 pma-fg-white">
        <div class="info-box">
            <span class="info-box-icon pma-icon executed">
            </span>
            <div class="info-box-content">
                <span class="info-box-text">
                {% if year != '2016' %}
                Ejecutado {{ ejecutado|million|intcomma }}
                {% endif %}
                </span>
                <span class="info-box-number pma-green"></span>
            </div>
            <!-- /.info-box-content -->
        </div>
        <!-- /.info-box -->
    </div>
    <div class="col-md-4">
        <div class="info-box">
            <span class="info-box-icon pma-icon initial">
            </span>
            <div class="info-box-content">
                <span class="info-box-text">Presupuesto{% if year != '2016'%} inicial{% endif %}</span>
                <span class="info-box-number pma-green">{{ asignado|million|intcomma }}</span>
            </div>
            <!-- /.info-box-content -->
        </div>
        <!-- /.info-box -->
    </div>
    <div class="col-md-4">
        <div class="info-box">
            <span class="info-box-icon pma-icon municipality-category">
            </span>
            <div class="info-box-content">
                {% if municipio %}
                {% endif %}
                <span class="info-box-text">Categor&iacute;a de municipio {{ mi_clase.clasificacion }}</span>
                <span class="info-box-number pma-green"></span>
            </div>
            <!-- /.info-box-content -->
        </div>
        <!-- /.info-box -->
    </div>
    {% endblock %}

{% block section1 %}
<div class="container">
    <div class="row">
        <div class="col-md-6">
            <div class="bubbletree-container">
                <div class="bubbletree-wrapper">
                    <div class="bubbletree"></div>
                </div>
            </div>
            <div class="btn-group">
                <button type="button" class="btn btn-default btn-lg" aria-label="Left Align">
                    <span class=" pe-7s-graph" aria-hidden="true"></span>
                </button>
                <button type="button" class="btn btn-default" aria-label="Center Align">
                    <span class=" pe-7s-graph3" aria-hidden="true"></span>
                </button>
                <button type="button" class="btn btn-default" aria-label="Right Align">
                    <span class=" pe-7s-graph2" aria-hidden="true"></span>
                </button>
                <button type="button" class="btn btn-default" aria-label="Justify">
                    <span class=" pe-7s-graph1" aria-hidden="true"></span>
                </button>
            </div>
        </div>
        <div class="col-md-6 table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr class="">
                        <th>Rubros de ingresos</th>
                        <th class="text-right">Inicial</th>
                        <th class="text-right">Ejecutado</th>
                    </tr>
                </thead>
                {% for row in rubros %}
                <tr>
                    <td>{{ row.subsubtipoingreso__origen__nombre}}</td>
                    <td class="text-right">{{ row.inicial_asignado|million|intcomma }}</td>
                    <td class="text-right">{{ row.ejecutado|million|intcomma|default:"0" }}</td>
                </tr>
                {% endfor %}
                <tfoot>
                    <tr class="">
                        <td>TOTAL</td>
                        <td class="text-right">{{ asignado|million|intcomma }}</td>
                        <td class="text-right">{{ejecutado|million|intcomma|default:"0" }}</td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
</div>
{% endblock %}
{% block section2 %}
<div class="row">

</div>
{% endblock %}
