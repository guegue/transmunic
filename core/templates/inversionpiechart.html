{% extends "base.html" %}
{% load static thumbnail chartit %}
{% load humanize %} 
{% load core_extras %} 
{% load mathfilters %} 
{% block main_content %}
    <form method="GET">
    <select name="year">
    {% for year in year_list %}
        <option {% if year == request.GET.year|add:"0" %}selected{% endif %} value="{{year}}">{{year}}</option>
    {% endfor %}
    </select>
    <select name="municipio">
    <option value="">--</option>
    {% for municipio in municipio_list %}
        <option {% if municipio.slug == request.GET.municipio %}selected{% endif %} value="{{municipio.slug}}">{{municipio}}</option>
    {% endfor %}
    </select>
    <input type="submit" value="Submit"/>
    </form>
    <div class="clearfix"></div>

    {% if municipio and charts.4 %}
        {{ charts|load_charts:"tipo, area, fuente, fuente_pie, comparativo_anios, percapita_anios, asignado" }}
    {% else %}
        {{ charts|load_charts:"tipo, area, fuente, fuente_pie, asignado" }}
    {% endif %}
    <!-- tabla4 -->
    <div class="col-md-6">
            <h3>Ingresos Totales del A&ntilde;o</h3>
            {% for total in totales %}
              <div class="row totales">
                <div class="col-md-8 text-left">
                    <img src="/static/img/{{ total.catinversion__nombre }}.png" class="pull-left" width="50" alt="{{ total.catinversion__nombre }}" />
                    <h4>{{ total.catinversion__nombre }}</h4>
                </div>
                <div class="col-md-2">
                    <span class="btn btn-info col-md-12">{{ total.percent }}</span>
                </div>
                {% if total.clase_percent %}
                <div class="col-md-2">
                    <span class="btn btn-info col-md-12">{{ total.clase_percent }}</span>
                </div>
                {% endif %}
              </div>
            {% endfor %}
    </div>
    <!-- tabla2 -->
    <div class="col-md-6">
            <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Clasificaci&oacute;n de la Inversi&oacute;n</th>
                    <th>Inicial</th>
                    <th>Ejecutado</th>
                    <th>%</th>
                </tr>
            </thead>
            <tbody>
            {% for total in cat %}
              <tr>
                <td class="text-left">{{ total.catinversion__nombre }}</td>
                <td>{{ total.asignado }}</td>
                <td>{{ total.ejecutado }}</td>
                <td>
                {% if total.asignado %}
                    <span class="text-success">{{ total.ejecutado|div:total.asignado|mul:100|floatformat:2 }}%</span>
                {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
            </table>
    </div>
    <br clear="all"><br /><bt />
    <div class="col-md-5">
            <table class="table table-bordered">
            <thead>
                <tr>
                    <th>A&ntilde;o</th>
                    <th>Inicial</th>
                    <th>Actualizado</th>
                    <th>Modificado</th>
                    <th>Ejecutado</th>
                    <th>Ejecutado/Inicial</th>
                </tr>
            </thead>
            {% for total in anuales %} 
              <tr>
                <td class="text-left">
                    <h4>{{ total.inversion__year }}</h4>
                </td>
                <td>{{ total.asignado }}</td>
                <td>{{ total.actualizado }}</td>
                <td>{{ total.actualizado|sub:total.asignado }}</td>
                <td>{{ total.ejecutado }}%</td>
                <td>
                {% if total.asignado %}
                    {{ total.ejecutado|div:total.asignado|mul:100|floatformat:2 }}%
                </div>
                {% endif %}
                </td>
              </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    <!-- tabla3 -->
    <br clear="all">
    <div class="col-md-9">
            <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Clasificaci&oacute;n de la Inversi&oacute;n</th>
                    <th>Inicial</th>
                    <th>Actualizado</th>
                    <th>Ejecutado</th>
                    <th>%</th>
                </tr>
            </thead>
            <tbody>
            {% for total in cat %}
              <tr>
                <td class="text-left">
                    <h4>{{ total.catinversion__nombre }}</h4>
                </td>
                <td>
                   {{ total.asignado }}</td>
                </td>
                <td>
                    {{ total.actualizado }}
                </td>
                <td>
                    {{ total.actualizado|sub:total.asignado }}
                </td>
                <td>
                    {{ total.ejecutado }}
                </td>
              </td>
            {% endfor %}
            </tbody>
        </table>
    </div>
    <!-- tabla1 -->
    <br clear="all"> <br />
    <div class="col-md-10">
          <h3>Inversiones ejecutadas en los &uacute;ltimos a&ntilde;os</h3>
          <table class="table table-condensed">
            <tr class="info">
              <th></th>
              {% for year in year_list %}
                <th>{{ year|date:"Y" }}</th>
              {% endfor %}
              <th>Promedio</th>
            </tr>
            {% for key, data in porano.items %}
             <tr>
               <td class="text-left">{{ key }}</td>
               {% for year in year_list %}
                 <td>{{ data|keyvalue:year|intword }}</td>
               {% endfor %}
               <td>{{ data.extra|intword }}</td>
               <!-- old-fashioned way:
               {% for subkey, subdata in data.items %}
               <td>{{ subkey }} = {{ subdata| intword}}</td>
               {% endfor %}
                -->
             </tr>
           {% endfor %}
 
          </table>
    </div>
    <div class="clearfix"></div>
    <div id='tipo'> Chart will be rendered here </div>
    <div id='area'> Chart will be rendered here </div>
    <div id='fuente'> Chart will be rendered here </div>
    <div id='fuente_pie'> Chart will be rendered here </div>
    <div id='comparativo_anios'> Chart will be rendered here </div>
    <div id='percapita_anios'> Chart will be rendered here </div>
    <div id='asignado'> Chart will be rendered here </div>
    <div id='ejecutado'> Chart will be rendered here </div>
    <div id='ultimos'> Chart will be rendered here </div>
{% endblock %}
