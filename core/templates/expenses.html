{% extends "_indicator.html" %}
{% load static thumbnail chartit humanize %}
{% load mathfilters %}
{% load core_extras %}

{% block indicator_description %}
{{indicator_description}}
{% endblock %}

            {% block main_table %}
            <table class="table table-striped table-hover" id="datatable-1">
                <thead>
                    <tr class="bg-primary">
                        <th class="text-left">Rubros de Gasto</th>
                        <th class="text-right">Inicial</th>
                        <th class="text-right">Ejecutado</th>
                        <th class="text-right">Porcentaje</th>
                    </tr>
                </thead>
                <tbody>
                {% for row in rubros %}
                <tr>
                    <td>{% firstof row.tipogasto__nombre row.subtipogasto__nombre %}</td>
                    <td class="text-right">{{ row.inicial_asignado|million|intcomma }}</td>
                    <td class="text-right">{{ row.ejecutado|million|intcomma }}</td>
                    {% if row.inicial_asignado %}
                        <td class="text-right">{{ row.ejecutado|div:row.inicial_asignado|mul:100|floatformat:1 }}%</td>
                    {% endif %}
                </tr>
                {% endfor %}
                </tbody>
                <tr class="">
                    <td>TOTAL</td>
                    <td class="text-right">{{ asignado|million|intcomma }}</td>
                    <td class="text-right">{{ ejecutado|million|intcomma }}</td>
                    <td class="text-right">{% if asignado %}{{ ejecutado|div:asignado|mul:100|floatformat:1 }}%{% endif %}</td>
                </tr>
            </table>
        {% endblock %}

{% block section2 %}
{% if municipio %}
<div class="cd-horizontal-timeline loaded pma-gradient inverted">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
            {% if municipio %}
              <h2><strong>Ranquin de municipio </strong>de misma categoría municipal </h2>
              <h4> Porcentaje del gasto total destinado a gastos de funcionamiento
                  "{{ mi_clase.clasificacion }}"</h4>
            {% else %}
              <h2>Porcentaje destinado a gastos de funcionamiento</h2>
              <h4>por categoría de Municipios</h4>
            {% endif %}
            <hr class="pma-line-3" />
            </div>
        </div>
    </div>
    <div class="timeline container">
        <div class="events-wrapper rankin">
            {% if municipio %}
            <div class="events" style="width: {{ otros|length|add:1|mul:270 }}px;">
                <ol>
                    {% for row in otros|dictsortreversed:"asignado_percent" %}
                    <li>
                        <a href=""
                            data-date="{% now "SHORT_DATETIME_FORMAT" %} 00:{{ forloop.counter }}"
                            {% if municipio.slug == row.gasto__municipio__slug %} class="selected"{% endif %}
                            style="left: {{ forloop.counter0|mul:270 }}px;"><span class="posicion">{{ row.gasto__municipio__nombre }}</span>
                            <br/>
                            {% if row.gasto__periodo == 'I' %}
                                <span class="line-cifra">{{ row.asignado_percent|intcomma }}</span>
                            {% else %}
                                <span class="line-cifra">{{ row.asignado_percent|intcomma }}</span>
                            {% endif %}
                        </a>
                    </li>
                    {% endfor %}
                </ol>
                <span class="filling-line" aria-hidden="true" style="transform: scaleX(0.0772222);"></span>
            </div> <!-- .events -->
            {% else %}
            <div class="events" style="width: {{ porclasep|length|add:1|mul:120 }}px;">
                <ol>
                    {% for row in porclasep|dictsort:"clasificacion" %}
                    <li>
                        <a href=""
                            data-date="{% now "SHORT_DATETIME_FORMAT" %} 00:{{ forloop.counter }}"
                            {% if municipio.slug == row.gasto__municipio__slug %} class="selected"{% endif %}
                            style="left: {{ forloop.counter0|mul:120 }}px;"><span class="posicion">{{ row.clasificacion }}</span>
                            <br/>
                            {% if row.gasto__periodo == 'I' %}
                                <span>{{ row.inicial_asignado|floatformat:2|intcomma }}</span>
                            {% else %}
                                <span>{{ row.ejecutado|floatformat:2|intcomma }}</span>
                            {% endif %}
                        </a>
                    </li>
                    {% endfor %}
                </ol>
                <span class="filling-line" aria-hidden="true" style="transform: scaleX(0.0772222);"></span>
            </div> <!-- .events -->
            {% endif %}
        </div> <!-- .events-wrapper -->

        <ul class="cd-timeline-navigation">
            <li><a href="#0" class="prev inactive">Prev</a></li>
            <li><a href="#0" class="next">Next</a></li>
        </ul> <!-- .cd-timeline-navigation -->
    </div> <!-- .timeline -->
    <div class="events-content container text-center">
        <ol>
        {% if municipio %}
          {% for row in otros|dictsortreversed:"asignado_percent" %}
          <li{% if municipio.slug == row.gasto__municipio__slug %} class="selected"{% endif %} data-date="{% now "SHORT_DATETIME_FORMAT" %} 00:{{ forloop.counter }}">
          <!-- <h4>{{ row.gasto__municipio__nombre }}</h4>
          <span> Asignado: {{ row.asignado_percent|intcomma }}
           </span><br/>
           <span> Ejecutado: {{ row.asignado_percent|intcomma }}</span> -->
          </li>
          {% endfor %}
        {% else %}
          {% for row in porclasep|dictsortreversed:"asignado_percent" %}
          <li{% if municipio.slug == row.gasto__municipio__slug %} class="selected"{% endif %} data-date="{% now "SHORT_DATETIME_FORMAT" %} 00:{{ forloop.counter }}">
          <!-- <h4>{{ row.gasto__municipio__nombre }}</h4>
          <span> Asignado: {{ row.asignado_percent|intcomma }}
           </span><br/>
           <span> Ejecutado: {{ row.asignado_percent|intcomma }}</span> -->
          </li>
          {% endfor %}
        {% endif %}
        </ol>
    </div> <!-- .events-content -->

    <div class="container">
        <div class="row">
            <div class="col-md-12 text-center medium">
                <button id="show-detail-1" class="blanco btn pma-bg-blue more" type="submit">
                Ver detalles en tabla</button>
            </div>
        </div>
    </div>
    <div id="detail-1" class="container">
        <div class="row">
            <div class="col-md-12 table-responsive">
                <h4 class="text-info text-info-ranking">Porcentaje del gasto
                    total destinado a {{indicator_name}}</h4>
                <table class="table table-condensed table-striped pma-bg-white">
                    <thead class="thead-inverse">
                        <tr class="bg-primary">
                            <th>Posición</th>
                            <th>Municipios</th>
                            <th>Inicial</th>
                            <th>Ejecutado</th>
                        </tr>
                    </thead>
                    {% for row in otros %}
                    {% if municipio.slug == row.gasto__municipio__slug%}
                    <tr class="info">
                        {% else %}
                        <tr>
                            {% endif %}
                            <td> {{forloop.counter}} </td>
                            <td>{{ row.gasto__municipio__nombre }}</td>
                            <td class="text-right">{{ row.asignado_percent }}%</td>
                            <td class="info text-right">{{ row.ejecutado_percent }}%</td>
                        </tr>
                        {% endfor %}
                        <tr class="success">
                            <td></td>
                            <td>PROMEDIO</td>
                            <td class="text-right">{{ otros|total_avg:'asignado_percent'|floatformat:1 }}%</td>
                            <td class="text-right">{{ otros|total_avg:'ejecutado_percent'|floatformat:1 }}%</td>
                        </tr>
                    </table>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% if not municipio %}
<div class="cd-horizontal-timeline loaded pma-gradient inverted">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
            <h2><strong>{{indicator_name}} </strong> <br>
                por categoría de Municipios</h2>
            <hr class="pma-line-3" />
            </div>
        </div>
    </div>
    <div class="timeline container">
        <div class="events-wrapper rankin">
            <div class="events" style="width: {{ porclasep|length|mul:200 }}px;">
                <ol>
                    {% for row in porclasep %}
                    <li>
                        <a href=""
                            data-date="{% now "SHORT_DATETIME_FORMAT" %} 00:{{ forloop.counter }}"
                            {% if forloop.last %} class="selected"{% endif %}
                            style="left: {{ forloop.counter0|mul:200 }}px;"><span class="posicion">{{ row.clasificacion }}</span>
                            <br/>
                            {% if periodo_list|keyvalue:year == 'I' %}
                              <span class="line-cifra">{% if row.asignado %}{{ row.asignado|floatformat:2 }}%{% else %} 0% {% endif %}
                              </span>
                            {% else %}
                              <span class="line-cifra">{% if row.ejecutado %}{{ row.ejecutado|floatformat:2 }}% {% else %} 0% {% endif %}</span>
                            {% endif %}
                        </a>
                    </li>
                    {% endfor %}
                </ol>
                <span class="filling-line" aria-hidden="true" style="transform: scaleX(0.0772222);"></span>
            </div> <!-- .events -->
        </div> <!-- .events-wrapper -->

        <ul class="cd-timeline-navigation">
            <li><a href="#0" class="prev inactive">Prev</a></li>
            <li><a href="#0" class="next">Next</a></li>
        </ul> <!-- .cd-timeline-navigation -->
    </div> <!-- .timeline -->
    <div class="events-content container text-center">
        <ol>
        {% for row in porclasep %}
        <li{% if forloop.last %} class="selected"{% endif %} data-date="{% now "SHORT_DATETIME_FORMAT" %} 00:{{ forloop.counter }}">
        </li>
        {% endfor %}
        </ol>
    </div> <!-- .events-content -->

    <div class="container">
        <div class="row">
            <div class="col-md-12 text-center medium">
                <button id="show-detail-1" class="blanco btn pma-bg-blue more" type="submit">
                Ver detalles en tabla</button>
            </div>
        </div>
    </div>
    <div id="detail-1" class="container">
        <div class="row">
            <div class="col-md-5 table-responsive col-md-offset-3">
                <h4 class="text-info text-info-ranking">Porcentaje del gasto total destinado a {{indicator_name}}</h4>
                <table class="table pma-bg-white">
                    <tr class="bg-primary"><th>Categoría</th> <th>P. Inicial</th> <th>Ejecutado</th></tr>
                    {% for row in porclasep %}
                    <tr>
                        <td class="text-center">{{ row.clasificacion }}</td>
                        <td class="text-right">{% if row.asignado %}{{ row.asignado|floatformat:2 }}%{% else %} 0% {% endif %}</td>
                        <td class="text-right">{% if row.ejecutado %}{{ row.ejecutado|floatformat:2 }}% {% else %} 0% {% endif %}</td>
                    </tr>
                    {% endfor %}
                    <tr class="bg-primary">
                        <td><strong>PROMEDIO</strong></td>
                        <td class="text-right"><strong>{{ porclasep|total_avg:'asignado'|floatformat:2 }}%</strong></td>
                        <td class="text-right"><strong>{{ porclasep|total_avg:'ejecutado'|floatformat:2 }}%</strong></td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% endblock %}

{% block section3 %}
<div class="container wide">
    <div class="row">
        <div class="col-md-12">
            <h2><strong>Información Histórica</strong><br>
            Ejecución presupuestaria del gasto de funcionamiento</h2>
            <hr class="pma-line-3" />
        </div>
    </div>
</div>
<div class="cd-horizontal-timeline loaded">
    <div class="timeline container historico">
        <div class="events-wrapper">
            <div class="events" style="width:{{ anuales|length|add:1|mul:135 }}px">
                <ol>
                    {% for row in anuales %}
                    <li><a href="" data-date="01/01/{{ row.gasto__anio }} 00:00"
                    {% if row.gasto__anio == year|add:"0" %} class="selected" {% endif %}
                    style="left:{{ forloop.counter|mul:"135" }}px;"><span class="posicion">{{ row.gasto__anio }}</span>
                    <br/>
                    {% if row.gasto__periodo == 'I' %}
                        <span class="line-cifra">{{ row.asignado|million|intcomma }}</span>
                    {% else %}
                        <span class="line-cifra">{{ row.ejecutado|million|intcomma }}</span>
                    {% endif %}
                    </a></li>
                    {% endfor %}
                </ol>
                <span class="filling-line" aria-hidden="true" style="transform: scaleX(0.0772222);"></span>
            </div> <!-- .events -->
        </div> <!-- .events-wrapper -->

        <ul class="cd-timeline-navigation">
            <li><a href="#0" class="prev inactive">Prev</a></li>
            <li><a href="#0" class="next">Next</a></li>
        </ul> <!-- .cd-timeline-navigation -->
    </div> <!-- .timeline -->

    <div class="events-content">
        <ol>
          {% for row in anuales %}
            <li><a href="#0" data-date="01/01/{{ row.gasto__anio }} 00:00"
            {% if row.gasto__anio == year|add:"0" %} class="selected" {% endif %}
            style="left:{{ forloop.counter|mul:"135" }}px;"></a></li>
          {% endfor %}
        </ol>
    </div> <!-- .events-content -->
</div>
<div class="container">
    <div class="row">
        <div class="col-md-12 text-center">
            <button id="show-detail-3" class="blanco btn pma-bg-blue more" type="submit">
            Ver detalles en tabla</button>
        </div>
    </div>
</div>
<div id="detail-3" class="container medium">
    <div class="row">
        <div class="col-md-offset-4 col-md-5 table-responsive">
            <table class="table table-bordered">
                <tr class="bg-primary"><th>Año</th> <th>Inicial</th> <th>Ejecutado</th> <th> <a href="#" data-toggle="tooltip" data-original-title="Ejecutado/Inicial" class="link-info blanco">%</a></th></tr>
                {% for row in anuales %}
                <tr>
                    <td>{{ row.gasto__anio }}</td>
                    <td class="text-right">{{ row.asignado|million|intcomma }}</td>
                    <td class="text-right">{{ row.ejecutado|million|intcomma }}</td>
                    {% if row.asignado %}
                    <td class="text-right">{{ row.ejecutado|div:row.asignado|mul:100|floatformat:1 }}%</td>
                    {% endif %}
                </tr>
                {% endfor %}
                <tr class="success bold">
                    <td>TOTAL</td>
                    <td class="text-right">{{ anuales|total_sum:'asignado'|million|intcomma }}</td>
                    <td class="text-right">{{ anuales|total_sum:'ejecutado'|million|intcomma }}</td>
                    {% with total_sum_asignado=anuales|total_sum:'asignado' %}</td>
                    <td class="text-right">{{ anuales|total_sum:'ejecutado'|div:total_sum_asignado|mul:100|floatformat:1 }}%</td>
                    {% endwith %}
                </tr>
            </table>
        </div>
    </div>
</div>
{% endblock %}


{% block section4 %}
<div class="container wide">
    <div class="row">
        <div class="col-md-12">
            <h2><strong>Modificaciones al presupuesto </strong>municipal</h2>
            <h4>{{indicator_name}} - Millones de córdobas corrientes </h4>
            <hr class="pma-line-3" />
        </div>
    </div>
    <div class="row">
        <div class="col-md-8 col-md-offset-2 table-responsive">
            <table class="table table-condensed">
                <tr class="bg-primary"> <th>Rubros de gastos</th> <th>Inicial</th>
                    <th>Actualizado</th> <th>Ejecutado</th>
                </tr>
                {% for row in rubros %}
                <tr>
                    <td>{% if row.tipogasto__nombre %}{{ row.tipogasto__nombre }}{% else %}{{ row.subtipogasto__nombre }}{% endif%}</td>
                    <td class="text-right">{{ row.inicial_asignado|million|intcomma }}</td>
                    <td class="text-right">{{ row.actualizado_asignado|million|intcomma }}</td>
                    <td class="text-right montos">
                    {% if row.final_asignado and row.final_ejecutado %}
                    {{ row.final_ejecutado|div:row.final_asignado|mul:100|floatformat:1|intcomma }}%
                    {% endif %}
                    </td>
                </tr>
                {% endfor %}
                <tr class="bold">
                    <td>TOTAL</td>
                    <td class="text-right">{{ rubros|total_sum:'inicial_asignado'|million|intcomma }}</td>
                    <td class="text-right">{{ rubros|total_sum:'actualizado_asignado'|million|intcomma }}</td>
                    <td class="text-right">{{ rubros|total_sum:'final_ejecutado'|million|intcomma }}</td>
                </tr>
            </table>
        </div>
        <div class="container">
            <div class="col-md-12 text-center medium">
                <button id="show-detail-2" class="blanco btn pma-bg-blue more" type="submit">
                Ver detalles </button>
            </div>
        </div>

        <div id="detail-2" class="row">
          <div class="col-md-12 table-responsive">
            <table class="table table-bordered">
                <tr class="bg-primary">
                    <td></td>
                    <td></td>
                    <td colspan="4" class="text-center">
                        <h4>Modificación intermedia
                            <a href="#" data-toggle="tooltip" data-original-title="Modificación al {{ year_data.actualizado }}" class="link-     info">*</a>
                        </h4>
                    </td>
                    <td colspan="4" class="text-center">
                        <h4>Modificación al cierre
                            <a href="#" data-toggle="tooltip" data-original-title="Modificación al {{ year_data.final }}" class="link-info">*</a>
                        </h4>
                    </td>
                </tr>
                <tr class="bg-primary"> <th>Rubros de gastos</th> <th>Inicial</th>
                    <th>Actualizado</th> <th>Modificación</th> <th>Ejecutado</th> <th><a href="#" data-toggle="tooltip" data-original-          title="Ejecutado/Actualizado" class="link-info">%</a></th>
                    <th>Actualizado</th> <th>Modificación</th> <th>Ejecutado</th> <th><a href="#" data-toggle="tooltip" data-original-          title="Ejecutado/Actualizado" class="link-info">%</a></th>
                </tr>
                {% for row in rubros %}
                <tr>
                    <td>{% if row.tipogasto__nombre %}{{ row.tipogasto__nombre }}{% else %}{{ row.subtipogasto__nombre }}{% endif%}</td>
                    <td class="text-right">{{ row.inicial_asignado|million|intcomma }}</td>
                    <td class="text-right">{{ row.actualizado_asignado|million|intcomma }}</td>
                    <td class="text-right">{% if row.actualizado_asignado %}
                        {{ row.actualizado_asignado|sub:row.inicial_asignado|million|intcomma }}{% else %}0{% endif %}</td>
                        <td class="text-right">{{ row.actualizado_ejecutado|million|intcomma }}</td>
                        {% if row.actualizado_asignado %}
                        <td class="montos">{{ row.actualizado_ejecutado|div:row.actualizado_asignado|mul:100|floatformat:1|intcomma }}%</td>
                        {% else %}
                        <td class="montos">0</td>
                        {% endif %}
                        <td class="text-right">{% if row.final_asignado %}{{ row.final_asignado|million|intcomma }}{% else %}0 {% endif  %}</td>
                        <td class="text-right">{% if row.final_asignado and row.inicial_asignado %}
                            {{ row.final_asignado|sub:row.inicial_asignado|million|intcomma }}{% else %}0{% endif %}</td>
                            <td class="text-right">{% if row.final_ejecutado %}{{ row.final_ejecutado|million|intcomma }}{% else %}0{% endif %}</td>
                            {% if row.final_asignado %}
                            <td class="montos">{{ row.final_ejecutado|div:row.final_asignado|mul:100|floatformat:1|intcomma }}%</td>
                            {% endif %}
                        </tr>
                        {% endfor %}
                        <tr class="bold">
                            <td>TOTAL</td>
                            <td class="text-right">{{ rubros|total_sum:'inicial_asignado'|million|intcomma }}</td>
                            <td class="text-right">{{ rubros|total_sum:'actualizado_asignado'|million|intcomma }}</td>
                            {% with sum_asignado=rubros|total_sum:'inicial_asignado' %}
                            <td class="montos text-right">
                                {% if rubros|total_sum:'actualizado_asignado' %}
                                {{ rubros|total_sum:'actualizado_asignado'|sub:sum_asignado|million|intcomma }}
                                {% else %}
                                0
                                {% endif %}
                            </td>
                            {% endwith %}
                            <td class="text-right">{{ rubros|total_sum:'actualizado_ejecutado'|million|intcomma }}</td>
                            {% with sum_actualizado=rubros|total_sum:'actualizado_asignado' %}
                            <td class="montos text-right">
                                {% if sum_actualizado %}
                                {{ rubros|total_sum:'actualizado_ejecutado'|div:sum_actualizado|mul:100|floatformat:1|intcomma}}%
                                {% endif %}
                            </td>
                            {% endwith %}
                            <!-- totales periodo final -->
                            <td class="text-right">{{ rubros|total_sum:'final_asignado'|million|intcomma }}</td>
                            {% with sum_asignado=rubros|total_sum:'inicial_asignado' %}
                            <td class="montosi text-right">
                                {% if rubros|total_sum:'final_asignado' %}
                                {{ rubros|total_sum:'final_asignado'|sub:sum_asignado|million|intcomma }}
                                {% else %}
                                0
                                {% endif %}
                            </td>
                            {% endwith %}
                            <td class="text-right">{{ rubros|total_sum:'final_ejecutado'|million|intcomma }}</td>
                            {% with sum_actualizado=rubros|total_sum:'final_asignado' %}
                            <td class="montos text-right">
                                {% if sum_actualizado %}
                                {{ rubros|total_sum:'final_ejecutado'|div:sum_actualizado|mul:100|floatformat:1|intcomma}}%
                                {% endif %}
                            </td>
                            {% endwith %}
                        </tr>
                    </table>
          </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_footer_scripts %}
    <script type="text/javascript" src="{% static 'js/jquery-migrate.min.js' %}"></script>
    <!-- <script type="text/javascript" src="{% static 'js/jquery.history.js' %}"></script> -->
    <script type="text/javascript" src="{% static 'js/raphael-min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/Tween.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/bubbletree.min.js' %}"></script>
    <script type="text/javascript" src="http://assets.openspending.org/openspendingjs/master/lib/aggregator.js"></script>
    <script type="text/javascript" src="{% static 'js/cofog.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/expense.js' %}"></script>
    <script type="text/javascript">
            var data = {{ bubble_data|safe }};
    </script>
    <script type="text/javascript" src="{% static 'js/pma-bubbletree.js' %}"></script>
    <script>
    $(document).ready(function(){
            $('[data-toggle="tooltip"]').tooltip({
                            placement : 'top'
                        });
            });
    </script>
    <script src="{% static 'js/pma.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/horizontal-timeline.js' %}"></script>
{% endblock %}

{% block custom_scripts %}
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/data.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    {{ charts|load_charts:"pie,bar" }}
{% endblock %}
