{% extends '_indicator.html' %}
{% load static humanize core_extras %}

{% block main_content %}
    <div class="container wide">
        <div class="row">
            {% if request.GET.municipio %}

                <div class="col-lg-12 col-md-12 col-sm-12">
                    <form class="navbar-form navbar-left">
                        <p>
                            Escoger el municipio: <select class="form-control" name="municipio2" id="municipio2">
                            <option value="">(Municipio)</option>
                            {% for municipio in municipios %}
                                <option value="{{ municipio.slug }}">{{ municipio.nombre }}</option>
                            {% endfor %}
                        </select>
                            con el que desea comparar.
                        </p>
                    </form>
                </div>

                <h3>{{ municipio }}</h3>
                <div class="col-lg-12 col-md-12 col-sm-12">
                    <table class="table table-bordered">
                        <thead>
                        <tr class="bg-primary">
                            <th>Clase</th>
                            {% for periodo in periodos %}
                                <th>{{ periodo }}<br>{{ periodo.clasificacion }}</th>
                            {% endfor %}
                        </tr>
                        </thead>
                        <tbody>
                        {% for clasificacion in clasificaciones %}
                            <tr>
                                <td>{{ clasificacion }}</td>
                                {% for value in data_tasa|keyvalue:clasificacion %}
                                    <td> {{ value }} </td>
                                {% endfor %}
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% if request.GET.municipio2 %}
                    <h3>{{ municipio2 }}</h3>
                    <div class="col-lg-12 col-md-12 col-sm-12">
                        <table class="table table-bordered">
                            <thead>
                            <tr class="bg-primary">
                                <th>Clase</th>
                                {% for periodo in periodos %}
                                    <th>{{ periodo }}<br>{{ periodo.clasificacion }}</th>
                                {% endfor %}
                            </tr>
                            </thead>
                            <tbody>
                        {% for clasificacion in clasificaciones %}
                            <tr>
                                <td>{{ clasificacion }}</td>
                                {% for value in data_tasa|keyvalue:clasificacion %}
                                    <td> {{ value }} </td>
                                {% endfor %}
                            </tr>
                        {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% endif %}
            {% else %}
                <div class="col-lg-12 col-md-12 col-sm-12">
		    <h2>Tasa de crecimiento promedio anual
			    por periodo de gobierno
		    </h2>
		    <h4>Asignaci&oacute;n total</h4>
                    <hr class="pma-line-1"/>
                    <table class="table table-bordered">
                        <thead>
                        <tr class="bg-primary">
                            <th>Clase</th>
                            {% for periodo in periodos %}
                                {% if not forloop.first %}
				    <th>{{ periodo }}</th>
				{% endif %}
                            {% endfor %}
                        </tr>
                        </thead>
                        <tbody>
                        {% for clasificacion in clasificaciones %}
                            <tr>
                                <td>{{ clasificacion }}</td>
                                {% for value in data_tasa|keyvalue:clasificacion|keyvalue:'total' %}
				    {% if not forloop.first %}
                                        <td> {{ value|floatformat:"2"}} </td>
				    {% endif %}
                                {% endfor %}
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
		    <p class="fuente">Fuente: Elaboración propia a partir de transmuni.gob.ni</p>

		    <h2>Tasa de crecimiento promedio anual
			    Asignaci&oacute;n por grupo de municipios
			    por periodo de gobierno
		    </h2>
		    <h4>Gastos corrientes</h4>
                    <hr class="pma-line-1"/>
                    <table class="table table-bordered">
                        <thead>
                        <tr class="bg-primary">
                            <th>Clase</th>
                            {% for periodo in periodos %}
				{% if not forloop.first %}
                                    <th>{{ periodo }}</th>
				{% endif %}
                            {% endfor %}
                        </tr>
                        </thead>
                        <tbody>
                        {% for clasificacion in clasificaciones %}
                            <tr>
                                <td>{{ clasificacion }}</td>
                                {% for value in data_tasa|keyvalue:clasificacion|keyvalue:'corriente' %}
				    {% if not forloop.first %}
                                        <td> {{ value|floatformat:"2" }} </td>
				    {% endif %}
                                {% endfor %}
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
		    <p class="fuente">Fuente: Elaboración propia a partir de transmuni.gob.ni</p>

		    <h2>Tasa de crecimiento promedio anual
			    Asignaci&oacute;n por grupo de municipios
			    por periodo de gobierno
		    </h2>
		    <h4>Gastos de capital</h4>
                    <hr class="pma-line-1"/>
                    <table class="table table-bordered">
                        <thead>
                        <tr class="bg-primary">
                            <th>Clase</th>
                            {% for periodo in periodos %}
				{% if not forloop.first %}
                                    <th>{{ periodo }}</th>
				{% endif %}
                            {% endfor %}
                        </tr>
                        </thead>
                        <tbody>
                        {% for clasificacion in clasificaciones %}
                            <tr>
                                <td>{{ clasificacion }}</td>
                                {% for value in data_tasa|keyvalue:clasificacion|keyvalue:'capital' %}
				    {% if not forloop.first %}
                                        <td> {{ value|floatformat:"2"}} </td>
				    {% endif %}
                                {% endfor %}
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
		    <p class="fuente">Fuente: Elaboración propia a partir de transmuni.gob.ni</p>
                </div>
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %}

{% block extra_footer_scripts %}
    <script>
        $(document).ready(function () {
            $('[data-toggle="tooltip"]').tooltip({
                placement: 'top'
            });
        });
    </script>
    <script src="{% static 'js/pma.js' %}"></script>
    <script>
        $(function () {
            let municipio2 = $('#municipio2');

            municipio2.on('change', function () {
                let parameters = window.location.search;
                let current_url = window.location.pathname;
                const urlParams = new URLSearchParams(parameters);
                //valido si existe municipio2 en la url para agregar o actualizar su valor
                if (urlParams.has('municipio2')){
                    urlParams.set('municipio2',$(this).val())
                }else{
                    urlParams.append('municipio2',$(this).val())
                }

                window.location.href = `${current_url}?${urlParams.toString()}`;
            })
        })
    </script>
{% endblock %}
