{% extends "_indicator.html" %}
{% load static thumbnail chartit %}
{% load humanize %}
{% load mathfilters %}
{% load core_extras %}
{% block titulo %}
    {{ obj.nombre }}
{% endblock %}

{% block indicator_title %}
    <h2 class="text-center">
        <strong>Destino de los gastos
            {% if periodo_list|keyvalue:year == 'F' %}
                presupuesto cierre
            {% elif periodo_list|keyvalue:year == 'A' %}
                ejecuci&oacute;n intermedia
            {% elif periodo_list|keyvalue:year == 'I' %}presupuesto
                inicial
            {% endif %}
            {% if year %}{{ year }}{% endif %}</strong>
    </h2>
    <hr class="pma-line-5"/>
    <h4 class="text-center">{% if municipio %}<strong>{{ municipio }}</strong><br/>{% else %}Consolidado
        153 municipios {% endif %}</h4>
    <p class="text-center metric-description container"></p>
{% endblock %}

{% block section1 %}
    <div class="container">
        <div class="row">
            <h2>
                <strong>Gastos
                    {% if periodo_list|keyvalue:year == 'F' %}Ejecutados
                    {% elif periodo_list|keyvalue:year == 'A' %}Presupuesto Intermedio
                    {% else %}Presupuesto Inicial{% endif %}
                    {{ year }}
                </strong>
            </h2>
            <h5>Millones de córdobas corrientes</h5>
            <hr class="pma-line-2">

            <div class="row pma-header-summary wide">
                {% block indicator_summary %}
                    <div class="col-xs-12 col-sm-6 col-md-4">
                        <div class="info-box">
                                <span class="info-box-icon pma-icon initial">
                                </span>
                            <div class="info-box-content">
                                    <span class="info-box-number font-17px">
                                        <strong>Inicial {{ asignado|million|intcomma }}</strong>
                                    </span>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-12 col-sm-6 col-md-4">
                        <div class="info-box">
                                <span class="info-box-icon pma-icon executed">
                                </span>
                            <div class="info-box-content">
                                    <span class="info-box-number font-17px">
                                        <strong>Cierre {{ ejecutado|million|intcomma }}</strong>
                                    </span>
                            </div>
                        </div>
                    </div>
                    {% if municipio %}
                        <div class="col-xs-12 col-sm-12 col-md-4">
                            <div class="info-box">
                                    <span class="info-box-icon pma-icon municipality-category">
                                    </span>
                                <div class="info-box-content">
                                        <span class="info-box-number font-17px">
                                            <strong>Grupo de municipio {{ mi_clase.clasificacion }}</strong>
                                        </span>
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <div class="col-xs-12 col-sm-12 col-md-4">
                            <div class="info-box">
                                    <span class="info-box-icon pma-icon pe-7s-date">
                                    </span>
                                <div class="info-box-content">
                                        <span class="info-box-number font-17px">
                                            <strong>Año {{ year }}</strong>
                                        </span>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                {% endblock %}
            </div>

            <div class="col-xs-12 col-sm-12 col-md-7">
                <div class="chart-update col-xs-12 col-sm-12 col-md-1 float-left">
                    <span class="pma-icon pe-7s-bubble pma-fg-gray toggle-chart"
                          aria-hidden="true" data-chartcontainer="bubble-1"></span>
                    <span id="chart-pie-1" class="pma-icon pe-7s-graph
                        pma-fg-gray toggle-chart" data-chartcontainer="pie"></span>
                    <span id="chart-bar-1" class="pma-icon pe-7s-graph3 pma-fg-gray toggle-chart"
                          data-chartcontainer="bar"></span>
                </div>

                <div class="col-xs-12 col-sm-12 col-md-11 bubbletree-container chart-container">
                    <div id="bubble-1" class="bubbletree-wrapper view-main">
                        <div class="bubbletree"></div>
                    </div>
                    <div id="pie" class="view-alternative"> Pastel Ejecucion por
                        Rubros
                    </div>
                    <div id="bar" class="view-alternative"> Barras Ejecucion por
                        Rubros
                    </div>
                </div>
            </div>
            <div class="col-xs-12 col-sm-12 col-md-5 table-responsive">
                <h4>Rubros de gastos para el per&iacute;odo {{ year }}
                    {% if periodo_list|keyvalue:year == 'F' %}
                        cierre
                    {% elif periodo_list|keyvalue:year == 'A' %}
                        intermedio
                    {% elif periodo_list|keyvalue:year == 'I' %}
                        inicial
                    {% endif %}
                </h4>
                <h5>
                    {% if periodo_list|keyvalue:year == 'F' %}
                        Ejecuci&oacute;n de gastos
                    {% elif periodo_list|keyvalue:year == 'A' %}
                        Ejecuci&oacute;n intermedia de gastos
                    {% elif periodo_list|keyvalue:year == 'I' %}
                        Presupuesto inicial de gastos
                    {% endif %}
                    {{ year }}
                    por su destino {% descargar_excel "oim1" %}</h5>
                <table class="table table-bordered table-condensed">
                    <thead>
                    <tr class="bg-primary">
                        <th rowspan="2" colspan="1" style="vertical-align: middle">Rubros de gastos</th>
                        {% if periodo_list|keyvalue:year == 'I' %}
                            <th rowspan="1" colspan="2" class="text-center no-border-bottom">Inicial</th>
                        {% else %}
                            <th rowspan="1" colspan="2" class="text-center no-border-bottom">Ejecutado</th>
                        {% endif %}
                    </tr>
                    <tr class="bg-primary">
                        <th rowspan="1" colspan="1" class="text-center no-border-top no-border-right">M. de C&oacute;rdobas</th>
                        <th rowspan="1" colspan="1" class="text-center no-border-top no-border-left">%</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for row in rubros %}
                        <tr>
                            <td>{{ row.subsubtipogasto__origen__nombre }}</td>
                            {% if periodo_list|keyvalue:year == 'I' %}
                                <td class="text-center">{{ row.inicial_asignado|million|intcomma }}</td>
                                <td class="text-center">{{ row.ini_asig_porcentaje }}%</td>
                            {% else %}
                                <td class="text-center">{{ row.ejecutado|million|intcomma }}</td>
                                <td class="text-center">{{ row.ejec_porcentaje }}%</td>
                            {% endif %}
                        </tr>
                    {% endfor %}
                    <tr>
                        <td>TOTAL</td>
                        {% if periodo_list|keyvalue:year == 'I' %}
                            <td class="text-center">{{ asignado|million|intcomma }}</td>
                            <td class="text-center">{{ rubros|total_sum:"ini_asig_porcentaje"|floatformat:0 }}</td>
                        {% else %}
                            <td class="text-center">{{ ejecutado|million|intcomma }}</td>
                            <td class="text-center">{{ rubros|total_sum:"ejec_porcentaje"|floatformat:0 }}</td>
                        {% endif %}
                    </tr>
                    </tbody>
                    <tfoot class="font-12px font-color-azul">
                    <tr class="pma-bg-white">
                        <th colspan="12" rowspan="1" class="text-justify"><strong>Fuente: </strong>Elaboraci&oacute;n
                            propia a partir
                            de transmunic.gob.ni<strong>.</strong></th>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
{% endblock %}

{% block section3 %}
    <div class="inverted loaded">
        {% if not municipio %}
            <div class="container">
                <div class="row">
                    <div class="col-lg-12 col-md-12 col-sm-12">
                        <h2><strong>Gastos de personal perc&aacute;pita, presupuesto</strong>
                            {% if periodo_list|keyvalue:year == 'F' %}
                                de cierre
                            {% elif periodo_list|keyvalue:year == 'A' %}
                                intermedio
                            {% elif periodo_list|keyvalue:year == 'I' %}
                                inicial
                            {% endif %}
                            {{ year }}
                            <br/>
                            {% if mi_clase.clasificacion %}
                                grupo "{{ mi_clase.clasificacion }}"
                            {% else %}
                                por grupos de municipios
                            {% endif %}

                        </h2>
                        <h5>C&oacute;rdobas corrientes por habitante {% if periodo_list|keyvalue:year == 'I' %}en
                            base a gastos asignados{% else %} en base a gastos ejecutados{% endif %}
                        </h5>
                        <hr class="pma-line-3"/>
                    </div>
                    <div class="col-lg-5 col-md-5 col-sm-12 table-responsive">
                        <table class="table table-bordered table-condensed pma-bg-white">
                            <thead>
                            <tr class="bg-primary">
                                <th>Categor&iacute;a de municipio</th> {% if periodo_list|keyvalue:year == 'I' %}
                                <th>Asignado</th> {% else %}
                                <th>Ejecutado</th>{% endif %}</tr>
                            </thead>
                            <tbody>
                            {% for row in porclasep %}
                                <tr>
                                    <td class="text-center">{{ row.clasificacion }}</td>
                                    {% if periodo_list|keyvalue:year == 'I' %}
                                        <td class="text-right">
                                            {% if row.asignado %}{{ row.asignado|floatformat:2|intcomma }}{% else %}
                                                0 {% endif %}</td>
                                    {% else %}
                                        <td class="text-right">
                                            {% if row.ejecutado %}{{ row.ejecutado|floatformat:2|intcomma }} {% else %}
                                                0 {% endif %}</td>
                                    {% endif %}
                                </tr>
                            {% endfor %}
                            <tr>
                                <td>
                                    <strong>TOTAL</strong>
                                </td>
                                {% if periodo_list|keyvalue:year == 'I' %}
                                    <td class="text-right">
                                        <strong>{{ porclasep|total_sum:'asignado'|floatformat:2|intcomma }}</strong>
                                    </td>
                                {% else %}
                                    <td class="text-right">
                                        <strong>{{ porclasep|total_sum:'ejecutado'|floatformat:2|intcomma }}</strong>
                                    </td>
                                {% endif %}
                            </tr>
                            </tbody>
                            <tfoot class="font-12px font-color-azul">
                            <tr>
                                <th colspan="12" rowspan="1" class="text-justify"><strong>Fuente: </strong>Elaboraci&oacute;n
                                    propia a partir
                                    de transmunic.gob.ni<strong>.</strong></th>
                            </tfoot>
                        </table>
                    </div>
                    {# chart horizontal chart #}
                    <div class="col-lg-7 col-md-7 col-sm-12 mt-1 height-horizontal-bar">
                        <div id="bar_horizontal" class="view-alternative"> Barra Horizontal
                        </div>
                    </div>
                </div>
            </div>

            <div class="events-content container text-center">
                <ol>
                    {% for row in porclasep %}
                        <li{% if forloop.first %} class="selected"{% endif %}
                                                  data-date="{% now "SHORT_DATETIME_FORMAT" %} 00:{{ forloop.counter }}">
                            <!--
           <h4>{{ row.clasificacion }}</h4>
        -->
                        </li>
                    {% endfor %}
                </ol>
            </div> <!-- .events-content -->
        {% else %}
            <div class="container">
                <div class="row">
                    <div class="{% if municipio|lower == 'managua' %} col-lg-12 col-md-12 col-sm-12 {% else %} col-lg-6 col-md-6 col-sm-12 {% endif %}">
                        <h2>
                            <strong>Rankin de gastos de personal percápita {{ year }}</strong>
                            Municipio de <strong>{{ municipio }}</strong> grupo
                            <strong>"{{ mi_clase.clasificacion }}"</strong>
                            {% if municipio|lower == 'managua' %}
                                categor&iacute;a municipal "{{ mi_clase.clasificacion }}" para el municipio de
                                <strong>{{ municipio }}</strong>
                                con
                                {% if periodo_list|keyvalue:year == 'I' %}
                                    {{ otros.0.asignado_percent|intcomma }}
                                {% else %}
                                    {{ otros.0.ejecutado_percent|intcomma }}
                                {% endif %}
                                Cordobas.
                            {% endif %}
                        </h2>
                        <h5>C&oacute;rdobas corrientes por habitante {% if periodo_list|keyvalue:year == 'I' %}en
                            base a gastos asignados{% else %} en base a gastos ejecutados{% endif %}
                        </h5>
                        <hr class="pma-line-3"/>
                        {% if municipio|lower != 'managua' %}
                            {% include 'municipal-triangle.html' %}
                        {% endif %}
                    </div>
                    {% if municipio|lower != 'managua' %}
                        {# chart horizontal chart #}
                        <div class="col-lg-6 col-md-6 col-sm-12 mt-1 height-horizontal-bar">
                            <div id="bar_horizontal" class="view-alternative"> Barra Horizontal
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>

            <div class="events-content container text-center">
                <ol>
                    {% for row in otros|dictsortreversed:"asignado_percent" %}
                        <li{% if municipio.slug == row.gasto__municipio__slug %} class="selected"{% endif %}
                                                                                 data-date="{% now "SHORT_DATETIME_FORMAT" %} 00:{{ forloop.counter }}">
                            <!-- <h4>{{ row.gasto__municipio__nombre }}</h4> -->
                            {% comment %}
        <span> Asignado: {{ row.asignado_percent|intcomma }}
        </span><br/>
        <span> Ejecutado: {{ row.asignado_percent|intcomma }}</span>
        {% endcomment %}
                        </li>
                    {% endfor %}
                </ol>
            </div> <!-- .events-content -->

            {% if municipio|lower != 'managua' %}
                <div class="container">
                    <div class="row">
                        <div class="col-md-12 text-center narrow">
                            <button id="show-detail-1" class="blanco btn pma-bg-blue more" type="submit">
                                Ver detalles en tabla
                            </button>
                        </div>
                    </div>
                </div>
                <div class="container" id="detail-1">
                    <div class="row">
                        <div class="col-md-offset-2 col-md-8 table-responsive">
                            <table class="table table-bordered  table-condensed table-striped pma-bg-white">
                                <thead class="thead-inverse">
                                <tr class="bg-primary">
                                    <th class="text-center"><strong>Posici&oacute;n</strong></th>
                                    <th class="text-center"><strong>Municipios</strong></th>
                                    {% if periodo_list|keyvalue:year == 'I' %}
                                        <th class="text-center"><strong>P. Inicial</strong></th>
                                    {% else %}
                                        <th class="text-center"><strong>Ejecuci&oacute;n</strong></th></tr>
                                    {% endif %}
                                </thead>
                                {% if ejecutado <= 0 %}
                                    {% for row in otros|dictsortreversed:"asignado_percent" %}
                                        {% if municipio.slug == row.gasto__municipio__slug %}
                                            <tr class="info">
                                                {% else %}
                                            <tr>
                                        {% endif %}
                                    <td class="text-center"> {{ forloop.counter }} </td>
                                    <td>{{ row.gasto__municipio__nombre }}</td>
                                    {% if periodo_list|keyvalue:year == 'I' %}
                                        <td class="text-right">{{ row.asignado_percent|intcomma }}</td>
                                    {% else %}
                                        <td class="text-right">{{ row.ejecutado_percent|intcomma }}</td>
                                    {% endif %}
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                    {% for row in otros %}
                                        {% if municipio.slug == row.gasto__municipio__slug %}
                                            <tr class="info">
                                                {% else %}
                                            <tr>
                                        {% endif %}
                                    <td class="text-center"> {{ forloop.counter }} </td>
                                    <td>{{ row.gasto__municipio__nombre }}</td>
                                    {% if periodo_list|keyvalue:year == 'I' %}
                                        <td class="text-right">{{ row.asignado_percent|intcomma }}</td>
                                    {% else %}
                                        <td class="text-right">{{ row.ejecutado_percent|intcomma }}</td>
                                    {% endif %}
                                    </tr>
                                    {% endfor %} {% endif %}
                                {% comment %}
                            <tr class="">
                                <td colspan="2">TOTAL</td>
                                <td class="text-right">
                                    {% if numerador > 0 %}
                                        {% with numerator=otros|total_sum:'asignado' denominator=otros|total_sum:'poblacion' %} {{ numerator|div:denominator|floatformat:2|intcomma }} {% endwith %}
                                    {% endif %}
                                </td>
                                {% if year != '2016' %}
                                <td class="text-right">
                                    {% if denominador > 0 %}
                                        {% with numerator=otros|total_sum:'ejecutado' denominator=otros|total_sum:'poblacion' %} {{ numerator|div:denominator|floatformat:2|intcomma }} {% endwith %}
                                    {% endif %}
                                </td>
                                {% endif %}
                            </tr>
                            {% endcomment %}
                            </table>
                        </div>
                    </div>
                </div>
            {% endif %}
        {% endif %}
    </div>
{% endblock %}

{% block section4 %}
    {% if rubros|total_sum:'actualizado_asignado' > 0 %}
        <div class="container wide">
            <div class="row">
                <div class="col-md-12">
                    <h2>
                        <strong>Gastos totales
                            {% if municipio %}
                                {{ municipio }} {{ year }}
                            {% else %}
                                {{ year }} consolidado 153 municipios
                            {% endif %}
                        </strong>
                    </h2>
                    <h3>Presupuesto inicial, intermedio, de cierre y su modificación por rubro</h3>
                    <h4>Millones de c&oacute;rdobas </h4>
                    <hr class="pma-line-3"/>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <!-- tabla para modificacion del presupuestno -->
                    <table class="table table-bordered table-condensed table-bordered">
                        <thead>
                        <tr>
                            <td colspan="2"></td>
                            <td colspan="4" class="text-center">
                                <h4>Modificaci&oacute;n intermedia
                                    <a href="#" data-toggle="tooltip"
                                       data-original-title="Modificaci&oacute;n al {{ year.actualizado }}"
                                       class="link-info">*</a>
                                </h4>
                            </td>
                            <td colspan="4" class="text-center">
                                <h4>Modificaci&oacute;n al cierre
                                    <a href="#" data-toggle="tooltip"
                                       data-original-title="Modificaci&oacute;n al {{ year_data.final }}"
                                       class="link-info">*</a>
                                </h4>
                            </td>
                        </tr>
                        <tr class="bg-primary">
                            <th>Rubros de gastos</th>
                            <th>Inicial</th>
                            <th>Actualizado</th>
                            <th>Modificaci&oacute;n</th>
                            <th>Ejecutado</th>
                            <th>
                                <a href="#" data-toggle="tooltip"
                                   data-original-title="Ejecutado/Actualizado"
                                   class="link-info font-color-white">%</a>
                            </th>
                            <th>Actualizado</th>
                            <th>Modificaci&oacute;n</th>
                            <th>Ejecutado</th>
                            <th><a href="#" data-toggle="tooltip"
                                   data-original-title="Ejecutado/Actualizado"
                                   class="link-info font-color-white">%</a>
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for row in rubros %}
                            <tr>
                                <td class="text-left">{% firstof row.tipogasto__nombre row.subsubtipogasto__origen__nombre %}</td>
                                <td class="text-center">{{ row.inicial_asignado|million|intcomma }}</td>
                                <td class="text-center">{{ row.actualizado_asignado|million|intcomma }}</td>
                                <td class="text-center">
                                    {% if row.inicial_asignado %}
                                        {{ row.actualizado_asignado|sub:row.inicial_asignado|million|intcomma }}
                                    {% else %}
                                        0
                                    {% endif %}
                                </td>
                                <td class="text-center">{{ row.actualizado_ejecutado|million|intcomma }}</td>
                                {% if row.actualizado_asignado %}
                                    <td class="montos text-center">{{ row.actualizado_ejecutado|div:row.actualizado_asignado|mul:100|floatformat:1|intcomma }}%</td>
                                {% else %}
                                    <td class="montos text-center">0%</td>
                                {% endif %}
                                <td class="text-center">
                                    {% if row.final_asignado %}
                                        {{ row.final_asignado|million|intcomma }}
                                    {% else %}
                                        0
                                    {% endif %}</td>
                                <td class="text-center">
                                    {% if row.final_asignado and row.inicial_asignado %}
                                        {{ row.final_asignado|sub:row.inicial_asignado|million|intcomma }}
                                    {% else %}
                                        0
                                    {% endif %}
                                </td>
                                <td class="text-center">
                                    {% if row.final_ejecutado %}
                                        {{ row.final_ejecutado|million|intcomma }}
                                    {% else %}
                                        0
                                    {% endif %}</td>
                                {% if row.final_asignado %}
                                    <td class="montos text-center">{{ row.final_ejecutado|div:row.final_asignado|mul:100|floatformat:1|intcomma }}%</td>
                                {% endif %}
                            </tr>
                        {% endfor %}
                        <tr class="bold">
                            <td>TOTAL</td>
                            <td class="text-center">{{ rubros|total_sum:'inicial_asignado'|million|intcomma }}</td>
                            <td class="text-center">{{ rubros|total_sum:'actualizado_asignado'|million|intcomma }}</td>
                            {% with sum_asignado=rubros|total_sum:'inicial_asignado' %}
                                <td class="montosi text-center">
                                    {% if rubros|total_sum:'actualizado_asignado' %}
                                        {{ rubros|total_sum:'actualizado_asignado'|sub:sum_asignado|million|intcomma }}
                                    {% else %}
                                        0
                                    {% endif %}
                                </td>
                            {% endwith %}
                            <td class="text-center">{{ rubros|total_sum:'actualizado_ejecutado'|million|intcomma }}</td>
                            {% with sum_actualizado=rubros|total_sum:'actualizado_asignado' %}
                                <td class="montos text-center">
                                    {% if sum_actualizado %}
                                        {{ rubros|total_sum:'actualizado_ejecutado'|div:sum_actualizado|mul:100|floatformat:1|intcomma }}
                                    {% else %}
                                        0
                                    {% endif %}
                                    %
                                </td>
                            {% endwith %}
                            <!-- totales periodo final -->
                            <td class="text-center">{{ rubros|total_sum:'final_asignado'|million|intcomma }}</td>
                            {% with sum_asignado=rubros|total_sum:'inicial_asignado' %}
                                <td class="montosi text-center">
                                    {% if rubros|total_sum:'final_asignado' %}
                                        {{ rubros|total_sum:'final_asignado'|sub:sum_asignado|million|intcomma }}
                                    {% else %}
                                        0
                                    {% endif %}
                                </td>
                            {% endwith %}
                            <td class="text-center">{{ rubros|total_sum:'final_ejecutado'|million|intcomma }}</td>
                            {% with sum_actualizado=rubros|total_sum:'final_asignado' %}
                                <td class="montos text-center">
                                    {% if sum_actualizado %}
                                        {{ rubros|total_sum:'final_ejecutado'|div:sum_actualizado|mul:100|floatformat:1|intcomma }}
                                        %
                                    {% endif %}
                                </td>
                            {% endwith %}
                        </tr>
                        </tbody>
                        <tfoot class="font-12px font-color-azul">
                        <tr class="pma-bg-white">
                            <th colspan="12" rowspan="1" class="text-justify"><strong>Fuente: </strong>Elaboraci&oacute;n
                                propia a partir
                                de transmunic.gob.ni<strong>.</strong></th>
                        </tfoot>
                    </table>
                </div>
                <div class="col-md-12">
                    <h2>Gasto de personal permanente {{ municipio }} {{ year }}</h2>
                    <h3>Presupuesto inicial, intermedio, de cierre y su modificación por rubro</h3>
                    <h4>Millones de c&oacute;rdobas </h4>
                    <hr class="pma-line-3"/>
                </div>
                <div class="col-md-12">
                    <table class="table table-bordered">
                        <thead>
                        <tr>
                            <td></td>
                            <td colspan="4" class="text-center">
                                <h4>Modificaci&oacute;n{% if year_data.actualizado %} al
                                    {{ year_data.actualizado }}{% else %}
                                    Inicial{% endif %}</h4></td>
                            <td colspan="4"><h4>Modificaci&oacute;n al cierre</h4>
                            </td>
                        </tr>
                        <tr class="bg-primary">
                            <th>Rubros de gastos</th>
                            <th>Inicial</th>
                            <th>Actualizado</th>
                            <th>Modificaci&oacute;n</th>
                            <th>Ejecutado</th>
                            <th><a href="#" data-toggle="tooltip" data-original-title="Ejecutado/Actualizado"
                                   class="link-info blanco">%</a></th>
                            <th>Actualizado</th>
                            <th>Modificaci&oacute;n</th>
                            <th>Ejecutado</th>
                            <th><a href="#" data-toggle="tooltip" data-original-title="Ejecutado/Actualizado"
                                   class="blanco">%</a></th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for row in rubrosp %}
                            <tr>
                                <td class="">{{ row.subsubtipogasto__nombre }}</td>
                                <td class="text-center">{{ row.inicial_asignado|million|intcomma }}</td>

                                <td class="text-center">{{ row.actualizado_asignado|million|intcomma }}</td>
                                <td class="text-center">{% if row.inicial_asignado %}
                                    {{ row.actualizado_asignado|sub:row.inicial_asignado|million|intcomma }}
                                {% else %}0{% endif %}
                                </td>
                                <td class="text-center">{{ row.actualizado_ejecutado|million|intcomma }}</td>
                                {% if row.actualizado_asignado %}
                                    <td class="montos text-center">{{ row.actualizado_ejecutado|div:row.actualizado_asignado|mul:100|floatformat:1|intcomma }}%</td>
                                {% else %}
                                    <td class="montos text-center">0%</td>
                                {% endif %}
                                <td class="text-center">
                                    {% if row.final_asignado %}{{ row.final_asignado|million|intcomma }}{% else %}
                                        0 {% endif %}</td>
                                <td class="text-center">{% if row.final_asignado and row.inicial_asignado %}
                                    {{ row.final_asignado|sub:row.inicial_asignado|million|intcomma }}
                                {% else %}0{% endif %}
                                </td>
                                <td class="text-center">
                                    {% if row.final_ejecutado %}{{ row.final_ejecutado|million|intcomma }}{% else %}
                                        0{% endif %}</td>
                                {% if row.final_asignado %}
                                    <td class="montos">{{ row.final_ejecutado|div:row.final_asignado|mul:100|floatformat:1|intcomma }}%</td>
                                {% endif %}
                            </tr>
                        {% endfor %}
                        <tr>
                            <td>TOTAL</td>
                            <td class="text-center">{{ rubrosp|total_sum:'inicial_asignado'|million|intcomma }}</td>
                            <td class="text-center">{{ rubrosp|total_sum:'actualizado_asignado'|million|intcomma }}</td>
                            {% with sum_asignado=rubrosp|total_sum:'inicial_asignado' %}
                                <td class="montosi text-center">
                                    {% if rubrosp|total_sum:'actualizado_asignado' %}
                                        {{ rubrosp|total_sum:'actualizado_asignado'|sub:sum_asignado|million|intcomma }}
                                    {% else %}
                                        0
                                    {% endif %}
                                </td>
                            {% endwith %}
                            <td class="text-center">{{ rubrosp|total_sum:'actualizado_ejecutado'|million|intcomma }}</td>
                            {% with sum_actualizado=rubrosp|total_sum:'actualizado_asignado' %}
                                <td class="montos text-center">
                                    {% if sum_actualizado %}
                                        {{ rubrosp|total_sum:'actualizado_ejecutado'|div:sum_actualizado|mul:100|floatformat:1|intcomma }}
                                        %
                                    {% else %}
                                        0%
                                    {% endif %}
                                </td>
                            {% endwith %}
                            <!-- totales periodo final -->
                            <td class="text-center">{{ rubrosp|total_sum:'final_asignado'|million|intcomma }}</td>
                            {% with sum_asignado=rubrosp|total_sum:'inicial_asignado' %}
                                <td class="montosi text-center">
                                    {% if rubrosp|total_sum:'final_asignado' %}
                                        {{ rubrosp|total_sum:'final_asignado'|sub:sum_asignado|million|intcomma }}
                                    {% else %}
                                        0
                                    {% endif %}
                                </td>
                            {% endwith %}
                            <td class="text-center">{{ rubrosp|total_sum:'final_ejecutado'|million|intcomma }}</td>
                            {% with sum_actualizado=rubrosp|total_sum:'final_asignado' %}
                                <td class="montos text-right">
                                    {% if sum_actualizado %}
                                        {{ rubrosp|total_sum:'final_ejecutado'|div:sum_actualizado|mul:100|floatformat:1|intcomma }}
                                        %
                                    {% endif %}
                                </td>
                            {% endwith %}
                        </tr>
                        </tbody>
                        <tfoot class="font-12px font-color-azul">
                        <tr class="pma-bg-white">
                            <th colspan="12" rowspan="1" class="text-justify"><strong>Fuente: </strong>Elaboraci&oacute;n
                                propia a partir
                                de transmunic.gob.ni<strong>.</strong></th>
                        </tfoot>
                    </table>
                    <!--- fin tabla de modificacion -->

                </div>
            </div>
        </div>
    {% endif %}
{% endblock %}

{% block section5 %}
    <div class="container">
        <div class="row">
            <div class="col-md-12 historico">
                <h2><strong>Informaci&oacute;n Hist&oacute;rica</strong><br/>
                    Ejecuci&oacute;n presupuestaria del gasto
                </h2>
                {% if not municipio %}<h4>Consolidado 153 municipios</h4>{% else %}<h4>{{ municipio }}</h4>{% endif %}
                <hr class="pma-line-3"/>
                <section class="cd-horizontal-timeline loaded historico">
                    <div class="timeline">
                        <div class="events-wrapper">
                            <div class="events" style="width: {{ anuales|length|add:1|mul:135 }}px;">
                                <ol>
                                    {% for row in anuales %}
                                        <li><a href="#0" data-date="01/01/{{ row.gasto__anio }} 00:00"
                                                {% if row.gasto__anio == year|add:"0" %} class="selected" {% endif %}
                                               style="left:{{ forloop.counter|mul:135 }}px;"><span
                                                class="posicion">{{ row.gasto__anio }}</span><br/>
                                            {% if row.gasto__periodo == 'I' %}
                                                <span class="line-cifra text-right">{{ row.asignado|million|intcomma }}</span>
                                            {% else %}
                                                <span class="line-cifra text-right">{{ row.ejecutado|million|intcomma }}</span>
                                            {% endif %}
                                        </a></li>
                                    {% endfor %}
                                </ol>

                                <span class="filling-line" aria-hidden="true"
                                      style="transform: scaleX(0.0772222);"></span>
                            </div> <!-- .events -->
                        </div> <!-- .events-wrapper -->

                        <ul class="cd-timeline-navigation">
                            <li><a href="#0" class="prev inactive">Prev</a></li>
                            <li><a href="#0" class="next">Next</a></li>
                        </ul> <!-- .cd-timeline-navigation -->
                    </div> <!-- .timeline -->

                    <div class="events-content">
                        <ol>
                            {% for row in anuales %}
                                <li data-date="01/01/{{ row.gasto__anio }} 00:00"
                                        {% if row.gasto__anio == year|add:"0" %} class="selected" {% endif %}>
                                </li>
                            {% endfor %}
                        </ol>
                    </div> <!-- .events-content -->
                </section>
            </div>
        </div>
        <div class="container">
            <div class="row">
                <div class="col-md-12 text-center mb-5px">
                    <button id="show-detail-3" class="blanco btn pma-bg-blue more" type="submit">
                        Ver detalles en tabla
                    </button>
                </div>
            </div>
        </div>

        <div id="detail-3" class="container medium">
            <div class="row">
                <div class="col-xs-12 text-center table-responsive">
                    <h3>Gastos por per&iacute;odo</h3>
                    <hr class="pma-line-4"/>
                    <div class="col-md-offset-4 col-md-5">
                        <table class="table table-condensed">
                            <thead>
                            <tr class="info">
                                <th>Años</th>
                                <th>Inicial</th>
                                <th>Ejecutado</th>
                                <th class="text-center">
                                    <a href="#" data-toggle="tooltip" data-original-title="Ejecutado/Inicial"
                                       class="link-info">%</a>
                                </th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for row in anuales %}
                                <tr>
                                    <td>{{ row.gasto__anio }}</td>
                                    <td class="text-right">{{ row.asignado|million|intcomma }}</td>
                                    <td class="text-right">{{ row.ejecutado|million|intcomma }}</td>
                                    {% if row.asignado %}
                                        <td class="montos">{{ row.ejecutado|div:row.asignado|mul:100|floatformat:1 }}%</td>
                                    {% endif %}
                                </tr>
                            {% endfor %}
                            <tr>
                                <td>TOTAL</td>
                                <td class="text-right">{{ anuales|total_sum:'asignado'|million }}</td>
                                <td class="text-right">{{ anuales|total_sum:'ejecutado'|million }}</td>
                                <td class="montos">
                                    {% with total_sum_asignado=anuales|total_sum:'asignado' %}
                                        {{ anuales|total_sum:'ejecutado'|div:total_sum_asignado|mul:100|floatformat:1 }}
                                        %
                                    {% endwith %}
                                </td>
                            </tr>
                            </tbody>
                            <tfoot class="font-12px font-color-azul">
                            <tr class="pma-bg-white">
                                <th colspan="12" rowspan="1" class="text-justify"><strong>Fuente: </strong>Elaboraci&oacute;n
                                    propia a partir
                                    de transmunic.gob.ni<strong>.</strong></th>
                            </tfoot>
                        </table>
                    </div>
                    <div class="col-md-12 text-center">
                        <h3>Gastos por per&iacute;odos por rubros</h3>
                        <hr class="pma-line-4"/>
                        <table class="table table-bordered ">
                            <thead>
                            <tr class="bg-primary">
                                <th rowspan="2" colspan="1"></th>
                                {% for year in year_list %}
                                    <th rowspan="1" colspan="2" class="text-center no-border-bottom">
                                        <strong>{{ year }}</strong>
                                        {% if periodo_list|keyvalue:year == 'A' %}*Actualizado*{% endif %}</th>
                                {% endfor %}
                            </tr>
                            <tr class="bg-primary">
                                {% for year in year_list %}
                                    <th rowspan="1" colspan="1" class="text-center no-border-top no-border-right">
                                        M. de C&oacute;rdobas
                                    </th>
                                    <th rowspan="1" colspan="1" class="text-center no-border-top no-border-left">
                                        %
                                    </th>
                                {% endfor %}
                            </tr>
                            </thead>
                            <tbody>
                            {% for key, data in porano.items %}
                                <tr>
                                    <td class="text-left">{{ key }}</td>
                                    {% for year in year_list %}
                                        {% with year_data=data|keyvalue:year %}
                                            <td class="text-right border-left">{{ year_data.raw|million|intcomma }}</td>
                                            <td class="text-right border-right">{{ year_data.percent|default:"0%" }}</td>
                                        {% endwith %}
                                    {% endfor %}
                                </tr>
                            {% endfor %}
                            </tbody>
                            <tfoot class="font-12px font-color-azul">
                            <tr class="pma-bg-white">
                                <th colspan="{{ year_list|length|mul:2|add:1 }}" rowspan="1" class="text-justify">
                                    <strong>Fuente: </strong>Elaboraci&oacute;n
                                    propia a partir
                                    de transmunic.gob.ni<strong>.</strong></th>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block custom_scripts %}
    {% if charts|length == 3 %}
        {{ charts|load_charts:"pie,bar,bar_horizontal" }}
    {% else %}
        {{ charts|load_charts:"pie,bar" }}
    {% endif %}

{% endblock %}
